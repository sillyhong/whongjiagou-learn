## 1\. ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡

-   æŠŠå®¢è§‚å¯¹è±¡æŠ½è±¡æˆå±æ€§æ•°æ®å’Œå¯¹æ•°æ®çš„ç›¸å…³æ“ä½œï¼ŒæŠŠå†…éƒ¨ç»†èŠ‚å’Œä¸æƒ³å…³çš„ä¿¡æ¯éšè—èµ·æ¥ï¼ŒæŠŠåŒä¸€ä¸ªç±»å‹çš„å®¢è§‚å¯¹è±¡çš„å±æ€§æ•°æ®å’Œæ“ä½œç»‘å®šåœ¨ä¸€èµ·ï¼Œå°è£…æˆç±»ï¼Œå¹¶ä¸”å…è®¸åˆ†æˆä¸åŒå±‚æ¬¡è¿›è¡ŒæŠ½è±¡ï¼Œé€šè¿‡ç»§æ‰¿å®ç°å±æ€§å’Œæ“ä½œçš„å…±äº«
    -   é¢å‘å¯¹è±¡çš„åˆ†æ OOA
    -   é¢å‘å¯¹è±¡çš„è®¾è®¡ OOD
    -   é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ OOP

### 1.1 æ¦‚å¿µ

-   ç±»ã€å¯¹è±¡(å®ä¾‹)
-   çˆ¶ç±»æ˜¯å…¬å…±çš„

```
class Animal{
    constructor(name) {
        this.name=name;
    }
    eat() {
        console.log(`${this.name} eat`)
    }
}
let animal=new Person('åŠ¨ç‰©');
animal.eat();

```

### 1.2 ç»§æ‰¿

-   å­ç±»ç»§æ‰¿çˆ¶ç±»
-   ç»§æ‰¿å¯ä»¥æŠŠå…¬å…±æ–¹æ³•æŠ½ç¦»å‡ºæ¥ï¼Œæé«˜å¤ç”¨ï¼Œå‡å°‘å†—ä½™

```
class Animal{
    constructor(name) {
        this.name=name;
    }
    eat() {
        console.log(`${this.name} eat`)
    }
    speak() {

    }
}
let animal=new Animal('åŠ¨ç‰©');
animal.eat();

class Dog extends Animal{
    constructor(name,age) {
        super(name);
        this.age=age;
    }
    speak() {
        console.log(`${this.name} is barking!`);
    }
}
let dog=new Dog('ğŸ¶',5);
dog.eat();
dog.bark();

```

### 1.3 å°è£…

-   æŠŠæ•°æ®å°è£…èµ·æ¥
-   å‡å°‘è€¦åˆï¼Œä¸è¯¥å¤–éƒ¨è®¿é—®çš„ä¸è¦è®©å¤–éƒ¨è®¿é—®
-   åˆ©äºæ•°æ®çš„æ¥å£æƒé™ç®¡ç†
-   ES6 ç›®å‰ä¸æ”¯æŒï¼Œä¸€èˆ¬è®¤ä¸º\_å¼€å¤´çš„éƒ½ä¼šç§æœ‰çš„ï¼Œä¸è¦ä½¿ç”¨
-   å®ç°
    -   public:å…¬æœ‰ä¿®é¥°ç¬¦ï¼Œå¯ä»¥åœ¨ç±»å†…æˆ–è€…ç±»å¤–ä½¿ç”¨publicä¿®é¥°çš„å±æ€§æˆ–è€…è¡Œä¸ºï¼Œé»˜è®¤ä¿®é¥°ç¬¦
    -   protected:å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦ï¼Œå¯ä»¥æœ¬ç±»å’Œå­ç±»ä¸­ä½¿ç”¨protectedä¿®é¥°çš„å±æ€§å’Œè¡Œä¸º
    -   private : ç§æœ‰ä¿®é¥°ç¬¦ï¼Œåªå¯ä»¥åœ¨ç±»å†…ä½¿ç”¨privateä¿®é¥°çš„å±æ€§å’Œè¡Œä¸º

```
class Animal {
    public name;
    protected age;
    private weight;
    constructor(name,age,weight) {
        this.name=name;
        this.age=age;
        this.weight=weight;
    }
}
class Person extends Animal {
    private money;
    constructor(name,age,weight,money) {
        super(name,age,weight);
        this.money=money;
    }
    getName() {
        console.log(this.name);
    }
    getAge() {
        console.log(this.age);
    }
    getWeight() {
        console.log(this.weight);
    }
}
let p=new Person('zfpx',9,100,100);
console.log(p.name);
console.log(p.age);
console.log(p.weight);

```

```
module: {
        rules: [
            {
                test: /\.js$/,
                use: {
                    loader: 'babel-loader',
                    options: {
                        presets:["@babel/preset-env"]
                    }
                }
            },
            {
                test: /\.ts$/,
                use: {
                    loader: 'ts-loader'
                }
            }
        ]
    }

```

### 1.4 å¤šæ€

-   åŒä¸€ä¸ªæ¥å£å¯ä»¥ä¸åŒå®ç°
-   ä¿æŒå­ç±»çš„å¼€æ”¾æ€§å’Œçµæ´»æ€§
-   é¢å‘æ¥å£ç¼–ç¨‹

```
class Animal {
    public name;
    protected age;
    private weight;
    constructor(name,age,weight) {
        this.name=name;
        this.age=age;
        this.weight=weight;
    }
}
class Person extends Animal {
    private money;
    constructor(name,age,weight,money) {
        super(name,age,weight);
        this.money=money;
    }
    speak() {
        console.log('ä½ å¥½!');
    }    
}
class Dog extends Animal {
    private money;
    constructor(name,age,weight) {
        super(name,age,weight);
    }
    speak() {
        console.log('æ±ªæ±ªæ±ª!');
    }    
}

let p=new Person('zfpx',10,10,10);
p.speak();
let d=new Dog('zfpx',10,10);
d.speak();

```

## 2\. è®¾è®¡åŸåˆ™

### 2.1 ä»€ä¹ˆæ˜¯è®¾è®¡ï¼Ÿ

-   æŒ‰å“ªä¸€ç§æ€è·¯æˆ–è€…æ ‡å‡†æ¥å®ç°åŠŸèƒ½
-   åŠŸèƒ½ç›¸åŒï¼Œå¯ä»¥æœ‰ä¸åŒè®¾è®¡çš„æ–¹å¼
-   éœ€æ±‚å¦‚æœä¸æ–­å˜åŒ–ï¼Œè®¾è®¡çš„ä½œç”¨æ‰èƒ½ä½“ç°å‡ºæ¥

## 2.2 SOLIDäº”å¤§è®¾è®¡åŸåˆ™

| é¦–å­—æ¯ | æŒ‡ä»£ | æ¦‚å¿µ |
| --- | --- | --- |
| S | å•ä¸€èŒè´£åŸåˆ™ | å•ä¸€åŠŸèƒ½åŸåˆ™è®¤ä¸ºå¯¹è±¡åº”è¯¥ä»…å…·æœ‰ä¸€ç§å•ä¸€åŠŸèƒ½çš„æ¦‚å¿µã€‚ |
| O | å¼€æ”¾å°é—­åŸåˆ™ | å¼€é—­åŸåˆ™è®¤ä¸ºâ€œè½¯ä»¶ä½“åº”è¯¥æ˜¯å¯¹äºæ‰©å±•å¼€æ”¾çš„ï¼Œä½†æ˜¯å¯¹äºä¿®æ”¹å°é—­çš„â€çš„æ¦‚å¿µã€‚ |
| L | é‡Œæ°æ›¿æ¢åŸåˆ™ | é‡Œæ°æ›¿æ¢åŸåˆ™è®¤ä¸ºâ€œç¨‹åºä¸­çš„å¯¹è±¡åº”è¯¥æ˜¯å¯ä»¥åœ¨ä¸æ”¹å˜ç¨‹åºæ­£ç¡®æ€§çš„å‰æä¸‹è¢«å®ƒçš„å­ç±»æ‰€æ›¿æ¢çš„â€çš„æ¦‚å¿µã€‚å‚è€ƒ å¥‘çº¦å¼è®¾è®¡ã€‚ |
| I | æ¥å£éš”ç¦»åŸåˆ™ | æ¥å£éš”ç¦»åŸåˆ™è®¤ä¸ºâ€œå¤šä¸ªç‰¹å®šå®¢æˆ·ç«¯æ¥å£è¦å¥½äºä¸€ä¸ªå®½æ³›ç”¨é€”çš„æ¥å£â€\[5\] çš„æ¦‚å¿µã€‚ |
| D | ä¾èµ–åè½¬åŸåˆ™ | ä¾èµ–åè½¬åŸåˆ™è®¤ä¸ºä¸€ä¸ªæ–¹æ³•åº”è¯¥éµä»â€œä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯ä¸€ä¸ªå®ä¾‹â€\[5\] çš„æ¦‚å¿µã€‚ä¾èµ–æ³¨å…¥æ˜¯è¯¥åŸåˆ™çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ |

### 2.2.1 S å•ä¸€èŒè´£åŸåˆ™

-   Single responsibility principle
-   ä¸€ä¸ªç¨‹åºåªåšå¥½ä¸€ä»¶äº‹
-   å¦‚æœåŠŸèƒ½ç‰¹åˆ«å¤æ‚å°±è¿›è¡Œæ‹†åˆ†

### 2.2.2 O å¼€æ”¾å°é—­åŸåˆ™

-   Open Closed Principle
-   å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
-   å¢åŠ éœ€æ±‚æ—¶ï¼Œæ‰©å±•æ–°ä»£ç ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç 
-   è¿™æ˜¯è½¯ä»¶è®¾è®¡çš„ç»ˆæç›®æ ‡

src/utils/request.js

```

function parseJSON(response) {
  return response.json();
}

function checkStatus(response) {
  if (response.status >= 200 && response.status < 300) {
    return response;
  }

  const error = new Error(response.statusText);
  error.response = response;
  throw error;
}


export default function request(url, options) {
  return fetch(url, options)
    .then(checkStatus)
    .then(parseJSON)
    .then(data=>{data})
    .catch(err => ({ err }));
}

```

### 2.2.3 L é‡Œæ°æ›¿æ¢åŸåˆ™

-   Liskov Substitution Principle
-   å­ç±»èƒ½è¦†ç›–çˆ¶ç±»
-   çˆ¶ç±»èƒ½å‡ºç°çš„åœ°æ–¹å­ç±»å°±èƒ½å‡ºç°
-   JSä½¿ç”¨æ¯”è¾ƒå°‘

### 2.2.4 I æ¥å£éš”ç¦»åŸåˆ™

-   Interface Segregation Principle
-   ä¿æŒæ¥å£çš„å•ä¸€ç‹¬ç«‹ï¼Œé¿å…å‡ºç°èƒ–æ¥å£
-   JSä¸­æ²¡æœ‰æ¥å£ï¼Œä½¿ç”¨è¾ƒå°‘
-   ç±»ä¼¼äºå•ä¸€èŒè´£åŸåˆ™ï¼Œæ›´å…³æ³¨æ¥å£

### 2.2.5 D ä¾èµ–å€’ç½®åŸåˆ™

-   Dependence Inversion Principle
-   é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“å®ç°
-   ä½¿ç”¨æ–¹åªå…³æ³¨æ¥å£è€Œä¸å…³æ³¨å…·ä½“ç±»çš„å®ç°
-   JSä¸­ä½¿ç”¨è¾ƒå°‘ï¼ˆæ²¡æœ‰æ¥å£ï¼Œå¼±ç±»å‹ï¼‰

## 3\. 23ç§è®¾è®¡æ¨¡å¼

### 3.1 åˆ›å»ºå‹

-   å·¥å‚æ¨¡å¼(å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€ç®€å•å·¥å‚æ¨¡å¼)
-   å»ºé€ è€…æ¨¡å¼
-   å•ä¾‹æ¨¡å¼
-   åŸå‹æ¨¡å¼

### 3.2 ç»“æ„å‹æ¨¡å¼

-   é€‚é…å™¨æ¨¡å¼
-   è£…é¥°å™¨æ¨¡å¼
-   ä»£ç†æ¨¡å¼
-   å¤–è§‚æ¨¡å¼
-   å·§æ¥æ¨¡å¼
-   ç»„åˆæ¨¡å¼
-   äº«å…ƒæ¨¡å¼

### 3.3 è¡Œä¸ºå‹

-   ç­–ç•¥æ¨¡å¼
-   æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼
-   è§‚å¯Ÿè€…æ¨¡å¼
-   è¿­ä»£å™¨æ¨¡å¼
-   èŒè´£é“¾æ¨¡å¼
-   å‘½ä»¤æ¨¡å¼
-   å¤‡å¿˜å½•æ¨¡å¼
-   çŠ¶æ€æ¨¡å¼
-   è®¿é—®è€…æ¨¡å¼
-   ä¸­ä»‹è€…æ¨¡å¼
-   è§£é‡Šå™¨æ¨¡å¼

## 4\. å·¥å‚æ¨¡å¼

### 4.1 ç®€å•å·¥å‚æ¨¡å¼

-   ç®€å•å·¥å‚æ¨¡å¼æ˜¯ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹
    
    #### 4.1.1 ç±»å›¾
    

![simplefactory](https://images.gitee.com/uploads/images/2019/0109/192757_d81529bf_1720749.jpeg)

#### 4.1.2 ä»£ç 

```
class Plant{
    constructor(name) {
        this.name=name;
    }
    grow() {
        console.log('growing~~~~~~');    
    }
}
class Apple extends Plant{
    constructor(name) {
        super(name);
        this.taste='ç”œ';
    }
}
class Orange extends Plant{
    constructor(name) {
        super(name);
        this.taste='é…¸';
    }
}
class Factory{
    static create(name) {
        switch (name) {
            case 'apple':
                return new Apple('è‹¹æœ');
            case 'orange':
                return new Orange('æ©˜å­');
        }
    }
}
let apple=Factory.create('apple');
console.log(apple);
let orange=Factory.create('orange');
console.log(orange);

```

#### 4.1.3 ç»å…¸åœºæ™¯

##### 4.1.3.1 jQuery

```
class jQuery{
    constructor(selector){
        let elements = Array.from(document.querySelectorAll(selector));
        let length = elements?elements.length:0;
        for(let i=0;i<length;i++){
            this[i]=elements[i];
        }
        this.length = length;
    }
    html(){

    }
}
window.$ = function(selector){
   return new jQuery(selector);
}

```

##### 4.1.3.2 React

```
class Vnode{
    constructor(tag,attrs,children){
        this.tag = tag;
        this.attrs = attrs;
        this.children = children;
    }
}
React.createElement = function(tag,attrs,children){
  return new Vnode(tag,attr,children);
}

```

### 4.2 å·¥å‚æ–¹æ³•æ¨¡å¼

-   å·¥å‚æ–¹æ³•æ¨¡å¼Factory Methodï¼Œåˆç§°å¤šæ€æ€§å·¥å‚æ¨¡å¼ã€‚
-   åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œæ ¸å¿ƒçš„å·¥å‚ç±»ä¸å†è´Ÿè´£æ‰€æœ‰çš„äº§å“çš„åˆ›å»ºï¼Œè€Œæ˜¯å°†å…·ä½“åˆ›å»ºçš„å·¥ä½œäº¤ç»™å­ç±»å»åšã€‚

#### 4.2.1 ç±»å›¾

![factorymethod](https://images.gitee.com/uploads/images/2019/0109/192757_4be3dac2_1720749.jpeg)

#### 4.2.2 ä»£ç 

```
class Plant{
    constructor(name) {
        this.name=name;
    }
    grow() {
        console.log('growing~~~~~~');    
    }
}
class Apple extends Plant{
    constructor(name) {
        super(name);
        this.taste='ç”œ';
    }
}
class Orange extends Plant{
    constructor(name) {
        super(name);
        this.taste='é…¸';
    }
}
class AppleFactory{
    create() {
        return new Apple();
    }
}
class OrangeFactory{
    create() {
        return new Orange();
    }
}
const settings={
    'apple': AppleFactory,
    'orange':OrangeFactory
}
let apple=new settings['apple']().create();
console.log(apple);
let orange=new settings['orange']().create();
console.log(orange);

```

### 4.3 æŠ½è±¡å·¥å‚æ¨¡å¼

-   æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯æŒ‡å½“æœ‰å¤šä¸ªæŠ½è±¡è§’è‰²æ—¶ï¼Œä½¿ç”¨çš„ä¸€ç§å·¥å‚æ¨¡å¼
-   æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥å‘å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œä½¿å®¢æˆ·ç«¯åœ¨ä¸å¿…æŒ‡å®šäº§å“çš„å…·ä½“çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºå¤šä¸ªäº§å“æ—ä¸­çš„äº§å“å¯¹è±¡

#### 4.3.1 ç±»å›¾

![abstractfactory](https://images.gitee.com/uploads/images/2019/0109/192757_7dc3c74a_1720749.jpeg)

#### 4.3.2 ä»£ç 

```
class Button{
    render() {

    }
}
class AppleButton{
    render() {
       console.log('è‹¹æœæŒ‰é’®');
    }
}
class WindowButton{
    render() {
       console.log('WindowsæŒ‰é’®');
    }
}

class Icon{
    render() {

    }
}
class AppleIcon{
    render() {
       console.log('è‹¹æœå›¾æ ‡');
    }
}
class WindowIcon{
    render() {
       console.log('Windowså›¾æ ‡');
    }
}
class Factory{
    createButton() {}
    createIcon() {}
}
class AppleFactory{
    createButton() {
        return new AppleButton();
    }
    createIcon() {
        return new AppleButton();
    }
}
class WindowsFactory{
    createButton() {
        return new WindowButton();
    }
    createIcon() {
        return new WindowIcon();
    }
}
const settings={
    'apple': AppleFactory,
    'windows':WindowsFactory
}
let appleFactory=new settings['apple']();
appleFactory.createButton().render();
appleFactory.createIcon().render();

let windowsFactory=new settings['windows']();
windowsFactory.createButton().render();
windowsFactory.createIcon().render();

```

## 5.å•ä¾‹æ¨¡å¼

#### 5.1 ç±»å›¾

[singleobject](http://img.zhufengpeixun.cn/singleobject.jpg)

#### 5.2 ä»£ç 

##### 5.2.1 typescript

```
class Window {
    constructor(name) {
        this.name = name;
    }
    static getInstance(name) {
        if (!this.instance) {
            this.instance = new Window(name);
        }
        return this.instance;
    }
}

var w1 = Window.getInstance();
var w2 = Window.getInstance();
console.log(w1 === w2);

```

##### 5.2.2 ES5å•ä¾‹æ¨¡å¼

```
let  Window = function(name) {
    this.name=name;
}
Window.prototype.getName=function () {
    console.log(this.name);
}
Window.getInstance=(function () {
    let window=null;
    return function (name) {
        if (!window)
           window=new Window(name);
        return window;
    }
})();
let window=Window.getInstance('zfpx');
window.getName();

```

##### 5.2.3 é€æ˜å•ä¾‹

```
let Window=(function () {
    let window;
    let Window=function (name) {
        if (window) {
            return window;
        } else {
            this.name=name;
            return (window=this);
        }
    }
    Window.prototype.getName=function () {
        console.log(this.name);
    }
    return Window;
})();

let window1=new Window('zfpx');
let window2=new Window('zfpx');
window1.getName();
console.log(window1 === window2)

```

##### 5.2.4 å•ä¾‹ä¸æ„å»ºåˆ†ç¦»

```
function Window(name) {
    this.name=name;
}
Window.prototype.getName=function () {
    console.log(this.name);
}

let createSingle=(function () {
    let instance;
    return function (name) {
        if (!instance) {
            instance=new Window();
        }
        return instance;
    }
})();

let window1=new createSingle('zfpx');
let window2=new createSingle('zfpx');
window1.getName();
console.log(window1 === window2)

```

##### 5.2.5 å°è£…å˜åŒ–

```
function Window(name) {
    this.name=name;
}
Window.prototype.getName=function () {
    console.log(this.name);
}

let createSingle=function (Constructor) {
    let instance;
    return function () {
        if (!instance) {
            Constructor.apply(this,arguments);
            Object.setPrototypeOf(this,Constructor.prototype)
            instance=this;
        }
        return instance;
    }
};
let CreateWindow=createSingle(Window);
let window1=new CreateWindow('zfpx');
let window2=new CreateWindow('zfpx');
window1.getName();
console.log(window1 === window2)

```

##### 5.2.6 å‘½åç©ºé—´

-   ç”¨æˆ·ç¼–å†™çš„ä»£ç ä¸å†…éƒ¨çš„ç±»/å‡½æ•°/å¸¸é‡æˆ–ç¬¬ä¸‰æ–¹ç±»/å‡½æ•°/å¸¸é‡ä¹‹é—´çš„åå­—å†²çªã€‚
-   ä¸ºå¾ˆé•¿çš„æ ‡è¯†ç¬¦åç§°åˆ›å»ºä¸€ä¸ªåˆ«åï¼ˆæˆ–ç®€çŸ­ï¼‰çš„åç§°ï¼Œæé«˜æºä»£ç çš„å¯è¯»æ€§ã€‚ jQuery
    
    ```
    let $ = {
      ajax(){},
      get(){},
      post(){}
    }
    
    ```
    

```
let utils={};
utils.def=function (namespace,fn) {
    let namespaces=namespace.split('.');
    let fnName=namespaces.pop();
    let current=utils;
    for (let i=0;i<namespaces.length;i++){
        let namespace=namespaces[i];
        if (!current[namespace]) {
            current[namespace]={};
        }
        current=current[namespace];
    }
    current[fnName]=fn;
}
utils.def('dom.attr',function (key) {
    console.log('dom.attr');
});
utils.def('dom.html',function (html) {
    console.log('dom.html');
});
utils.def('string.trim',function () {
    console.log('string.trim');
});
utils.dom.attr('src');
utils.string.trim(' aaa ');

```

#### 5.3 åœºæ™¯

##### 5.3.1 jQuery

```
if(window.jQuery!=null){
  return window.jQuery;
}else{
    //init~~~~~~~
}

```

##### 5.3.2 æ¨¡æ€çª—å£

```
class Login{
    constructor() {
        this.element=document.createElement('div');
        this.element.innerHTML=(
            `
            ç”¨æˆ·å <input type="text"/>
            <button>ç™»å½•</button>
            `
        );
        this.element.style.cssText='width: 100px; height: 100px; position: absolute; left: 50%; top: 50%; display: block;';
        /* this.element.style.width='100px';
        this.element.style.height='100px';
        this.element.style.position='absolute';
        this.element.style.left='50%';
        this.element.style.top='50%'; */
        document.body.appendChild(this.element);
    }
    show() {
        this.element.style.display='block';
    }
    hide() {
        this.element.style.display='none';
    }
}
Login.getInstance=(function () {
    let instance;
    return function () {
        if (!instance) {
            instance=new Login();
        }
        return instance;
    }
})();

document.getElementById('showBtn').addEventListener('click',function (event) {
    Login.getInstance().show();
});
document.getElementById('hideBtn').addEventListener('click',function (event) {
    Login.getInstance().hide();
});

```

##### 5.3.3 store

```
function createStore(reducer) {
    let state;
    let listeners=[];
    function getState() {
        return state;
    }
    function dispatch(action) {
        state=reducer(state,action);
        listeners.forEach(l=>l());
    }
    function subscribe(listener) {
        listeners.push(listener);
        return () => {
            listeners = listeners.filter(item => item!=listener);
            console.log(listeners);
        }
    }
    dispatch({});
    return {
        getState,
        dispatch,
        subscribe
    }
}
let store = createStore();

```

##### 5.3.4 ç¼“å­˜

```
let express=require('express');
let fs=require('fs');
let cache={};
let app=express();
app.get('/user/:id',function (req,res) {
    let id=req.params.id;
    let user=cache.get(id);
    if (user) {
        res.json(user);
    } else {
        fs.readFile(`./users/${id}.json`,'utf8',function (err,data) {
            let user=JSON.parse(data);
            cache.put(id,user);
            res.json(user);
        });
    }
});

app.get('/user',function (req,res) {
    let user=req.query;
    fs.writeFile(`./users/${user.id}.json`,JSON.stringify(user),(err) => {
        console.log(err);
        res.json({code: 0,data: 'å†™å…¥æˆåŠŸ'});
    });
});
app.listen(3000);

```

##### 5.3.5 LRUç¼“å­˜

-   [lru-cache](https://leetcode.com/problems/lru-cache/)
-   ä¸ºLRU Cacheè®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒæ”¯æŒä¸¤ä¸ªæ“ä½œï¼š
    -   1ï¼‰get(key)ï¼šå¦‚æœkeyåœ¨cacheä¸­ï¼Œåˆ™è¿”å›å¯¹åº”çš„valueå€¼ï¼Œå¦åˆ™è¿”å›-1
    -   2ï¼‰set(key,value):å¦‚æœkeyä¸åœ¨cacheä¸­ï¼Œåˆ™å°†è¯¥(key,value)æ’å…¥cacheä¸­ï¼ˆæ³¨æ„ï¼Œå¦‚æœcacheå·²æ»¡ï¼Œåˆ™å¿…é¡»æŠŠæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„å…ƒç´ ä»cacheä¸­åˆ é™¤ï¼‰ï¼›å¦‚æœkeyåœ¨cacheä¸­ï¼Œåˆ™é‡ç½®valueçš„å€¼ã€‚

```
/**
- ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨æ•°æ®ï¼Œç»™æ¯ä¸€ä¸ªæ•°æ®é¡¹æ ‡è®°ä¸€ä¸ªè®¿é—®æ—¶é—´æˆ³
- æ¯æ¬¡æ’å…¥æ–°æ•°æ®é¡¹çš„æ—¶å€™ï¼Œå…ˆæŠŠæ•°ç»„ä¸­å­˜åœ¨çš„æ•°æ®é¡¹çš„æ—¶é—´æˆ³è‡ªå¢,å¹¶å°†æ–°æ•°æ®é¡¹çš„æ—¶é—´æˆ³ç½®ä¸º0å¹¶æ’å…¥åˆ°æ•°ç»„ä¸­
- æ¯æ¬¡è®¿é—®æ•°ç»„ä¸­çš„æ•°æ®é¡¹çš„æ—¶å€™ï¼Œå°†è¢«è®¿é—®çš„æ•°æ®é¡¹çš„æ—¶é—´æˆ³ç½®ä¸º0ã€‚
- å½“æ•°ç»„ç©ºé—´å·²æ»¡æ—¶ï¼Œå°†æ—¶é—´æˆ³æœ€å¤§çš„æ•°æ®é¡¹æ·˜æ±°ã€‚
*/
class LRUCache{
    constructor(capacity) {
        this.capacity=capacity;
        this.members=[];
    }
    put(key,value) {
        let found=false;
        let oldestIndex=-1;
        let oldestAge=-1;
        for (let i=0;i<this.members.length;i++){
            let member=this.members[i];
            if (member.age > oldestAge) {
                oldestIndex=i;
                oldestAge=member.age;
            }
            if (member.key==key) {
                this.members[i]={key,value,age: 0};
                found=true;
            } else {
                member++;
            }
        }
        if (!found) {
            if (this.members.length>=this.capacity) {
                this.members.splice(oldestIndex,1);
            }
            this.members[this.members.length]={
                key,
                value,
                age:0
            }
        }
    }
    get(key) {
        for (let i=0;i<this.members.length;i++){
            let member=this.members[i];
            if (member.key==key) {
                member.age=0;
                return member.value;
            }
        }    
        return -1;
    }
}

let cache=new LRUCache(3);
cache.put('1',1);
cache.put('2',2);
cache.put('3',3);
console.log(cache.get('1'));
console.log(cache.get('2'));
console.log(cache.get('3'));
cache.put('4',4);
console.log(cache.get('1'));
console.log(cache.get('4'));
console.log(cache);

```

## 6\. é€‚é…å™¨æ¨¡å¼

-   æ—§çš„æ¥å£å’Œä½¿ç”¨è€…ä¸å…¼å®¹
-   ä¸­é—´åŠ ä¸€ä¸ªé€‚é…å™¨è½¬æ¢æ¥å£

![adaptor](https://images.gitee.com/uploads/images/2019/0109/192757_60d9b4d0_1720749.jpeg) ![hdmi2vga](https://images.gitee.com/uploads/images/2019/0109/192757_4636e2ed_1720749.jpeg) ![usbadaptor](https://images.gitee.com/uploads/images/2019/0109/192757_6782d834_1720749.jpeg)

#### 6.1 ç±»å›¾

![adapter](https://images.gitee.com/uploads/images/2019/0109/192758_7cb9542a_1720749.jpeg)

#### 6.2 ä»£ç 

```
class Power{
    charge() {
        return '220V';
    }
}

class Adapter{
    constructor() {
        this.power=new Power();
    }
    charge() {
        let power=this.power.charge();
        return `${power} => 12V`;
    }
}

class Client{
    constructor() {
        this.adapter=new Adapter();
    }
    use() {
        console.log(this.adapter.charge());
    }
}
new Client().use();


```

#### 6.3 åœºæ™¯

##### 6.3.1 æ’ä»¶é€‚é…

-   é€‚é…å‚æ•°
-   é€‚é…åç«¯æ¥å£æ•°æ®

```
function ajax(options){
  let _default = {
      method:'GET',
      dataType:'json'
  }
  for(let attr in options){
    _default[attr] = options[attr]||_default[attr];
  }
}

function get(url){
  let options = {method:'GET',url};
  ajax(options);
}

```

##### 6.3.1 promisify

```
let fs=require('fs');
function promisify(readFile) {
    return function (filename,encoding) {
        return new Promise(function (resolve,reject) {
            readFile(filename,encoding,function (err,data) {
                if (err)
                    reject(err);
                else
                    resolve(data);
            })
        });
    }
}
let readFile=promisify(fs.readFile);
readFile('./1.txt','utf8').then(data => console.log(data));

```

##### 6.3.2 jquery

```
let $=require('jquery');
$.ajax({
    url,
    type: 'POST',
    dataType: 'json',
    data:{id:1}
});

let $={
    ajax(options) {
        fetch(options.url,{
            method: options.type,
            body:JSON.stringify(options.data)
        })
    }
}

```

##### 6.3.3 computed

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
    <title>vue</title>
</head>
<body>
<div id="root">
<p>{{name}}</p>
<p>{{upperName}}</p>
</div>    
<script>
let vm=new Vue({
    el: '#root',
    data: {
        name:'zfpx'
    },
    computed: {
        upperName() {
            return this.name.toUpperCase();
        }
    }
});
</script>
</body>
</html>

```

## 7.è£…é¥°å™¨æ¨¡å¼

-   åœ¨ä¸æ”¹å˜å…¶åŸæœ‰çš„ç»“æ„å’ŒåŠŸèƒ½ä¸ºå¯¹è±¡æ·»åŠ æ–°åŠŸèƒ½
-   è£…é¥°æ¯”ç»§æ‰¿æ›´åŠ çµæ´»

#### 7.1 ç±»å›¾

![decorator](https://images.gitee.com/uploads/images/2019/0109/192758_4ef3d187_1720749.png)

#### 7.2 ä»£ç 

```
class Duck{
    eat(food) {
        console.log('åƒ${food}');
    }
}

class TangDuck{
    constructor() {
        this.duck=new Duck();
    }
    eat() {
        this.duck.eat();
        console.log('è°¢è°¢');
    }
}

```

#### 7.3 åŒ…è£…å™¨

è£…é¥°å™¨æ¨¡å¼æ˜¯å°†ä¸€ä¸ªå¯¹è±¡åµŒå…¥å¦ä¸€ä¸ªå¯¹è±¡ä¹‹ä¸­ï¼Œå®é™…ä¸Šç›¸å½“äºè¿™ä¸ªå¯¹è±¡è¢«å¦ä¸€ä¸ªå¯¹è±¡åŒ…è£…èµ·æ¥ï¼Œå½¢æˆä¸€æ¡åŒ…è£…é“¾ã€‚è¯·æ±‚éšç€è¿™æ¡é“¾æ¡ä¾æ¬¡ä¼ é€’åˆ°æ‰€æœ‰çš„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰å¤„ç†è¿™ä¸ªè¯·æ±‚çš„æœºä¼šã€‚

```
class Coffee{
  make(water){
    return `${water}+å’–å•¡`;
  }
  cost(){
      return 10;
  }
}

class MilkCoffee{
    constructor(parent){
        this.parent = parent;
    }
    make(water){
        return `${this.parent.make(water)}+ç‰›å¥¶`;
    }
    cost(){
        return this.parent.cost()+1;
    }
}

class SugerCoffee{
    constructor(parent){
        this.parent = parent;
    }
    make(water){
        return `${this.parent.make(water)}+ç³–`;
    }
    cost(){
        return this.parent.cost()+2;
    }
}
let coffee = new Coffee();
let milkCoffee = new MilkCoffee(coffee);
let milksugerCoffee = new SugerCoffee(milkCoffee);
console.log(milksugerCoffee.make('æ°´')+'='+milksugerCoffee.cost());

```

#### 7.4 AOP

-   åœ¨è½¯ä»¶ä¸šï¼ŒAOPä¸ºAspect Oriented Programmingçš„ç¼©å†™ï¼Œæ„ä¸ºï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹
-   å¯ä»¥é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ç»™ç¨‹åºåŠ¨æ€ç»Ÿä¸€æ·»åŠ åŠŸèƒ½çš„ä¸€ç§æŠ€æœ¯

![springaop](https://images.gitee.com/uploads/images/2019/0109/192758_281046e5_1720749.jpeg) ![businessaop](https://images.gitee.com/uploads/images/2019/0109/192758_c7aedff9_1720749.jpeg)

```
Function.prototype.before = function(beforeFn){
    let _this = this;
    return function(){
        beforeFn.apply(this,arguments);
        return _this.apply(this,arguments);
    }
}
Function.prototype.after = function(afterFn){
    let _this = this;
    return function(){
         _this.apply(this,arguments);
        afterFn.apply(this,arguments);
    }
}
function buy(money,goods){
  console.log(`èŠ±${money}ä¹°${goods}`);
}
buy = buy.before(function(){
    console.log(`å‘åª³å¦‡ç”³è¯·1å—é’±.`);
});
buy = buy.after(function(){
    console.log(`æŠŠå‰©ä¸‹çš„2æ¯›é’±è¿˜ç»™åª³å¦‡.`);
});
buy(.8,'ç›');

```

#### 7.3 åœºæ™¯

##### 7.3.1 åŸ‹ç‚¹

åŸ‹ç‚¹åˆ†æï¼Œæ˜¯ç½‘ç«™åˆ†æçš„ä¸€ç§å¸¸ç”¨çš„æ•°æ®é‡‡é›†æ–¹æ³•

-   åŸ‹ç‚¹æ–¹å¼
    -   æœåŠ¡å™¨å±‚é¢çš„ï¼šä¸»è¦æ˜¯é€šè¿‡å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œåˆ†æ
    -   å®¢æˆ·ç«¯å±‚é¢çš„ï¼šé€šè¿‡åŸ‹ç‚¹è¿›è¡Œç›¸åº”çš„åˆ†æ
        -   ä»£ç åŸ‹ç‚¹
        -   è‡ªåŠ¨åŒ–åŸ‹ç‚¹ï¼šé€šè¿‡AOPæ€æƒ³å¯¹ç›¸åº”çš„æ–¹æ³•è¿›è¡Œç»Ÿè®¡
        -   ç¬¬ä¸‰æ–¹å®ç° ç™¾åº¦ã€å‹ç›Ÿç­‰...

```
<body>
    <button data-name="è¥¿ç“œ" id="watermelon">è¥¿ç“œ</button>
    <button data-name="è‹¹æœ" id="apple">è‹¹æœ</button>
<script>
 let watermelon = document.getElementById('watermelon');
 let apple = document.getElementById('apple');
 Function.prototype.after = function(afterFn){
    let _this = this;
    return function(){
         _this.apply(this,arguments);
        afterFn.apply(this,arguments);
    }
}

 function click(){
     console.log('ç‚¹å‡»'+this.dataset.name);
 }
 click = click.after(function(){
     let img = new Image();
     img.src = `http://localhost:3000?name=${this.dataset.name}`;
 });
 Array.from(document.querySelectorAll('button')).forEach(function(button){
    button.addEventListener('click',click);
 });

```

```
let express = require('express');
let app = express();
app.get('/',function(req,res){
   console.log('name',req.query.name);
   res.end('ok');
});
app.listen(3000);

```

##### 7.3.2 è¡¨å•æ ¡éªŒ

```
<body>
    <form action="">
        ç”¨æˆ·å<input type="text" name="username" id="username">
        å¯†ç <input type="text" name="password" id="password">
        <button id="submit-btn" >æäº¤</button>
    </form>
    <script>
         Function.prototype.before = function(beforeFn){
            let _this = this;
            return function(){
                let ret = beforeFn.apply(this,arguments);
                if(ret)
                _this.apply(this,arguments);
            }
        }
      function submit(){
          alert('æäº¤è¡¨å•');
      }
      submit= submit.before(function(){
          let username = document.getElementById('username').value;
          if(username.length<6){
              return alert('ç”¨æˆ·åä¸èƒ½å°‘äº6ä½');
          }
          return true;
      });
      submit = submit.before(function(){
          let username = document.getElementById('username').value;
          if(!username){
              return alert('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
          }
          return true;
      });


      document.getElementById('submit-btn').addEventListener('click',submit);

```

##### 7.3.3 é˜²CSRFæ”»å‡»

-   CSRFé€šè¿‡ä¼ªè£…æ¥è‡ªå—ä¿¡ä»»ç”¨æˆ·çš„è¯·æ±‚æ¥åˆ©ç”¨å—ä¿¡ä»»çš„ç½‘ç«™

![csrf.jpg](https://images.gitee.com/uploads/images/2019/0109/192758_c0455bf9_1720749.jpeg)

###### 7.3.3.1 å—ä¿¡ä»»ç½‘ç«™

```
let express = require('express');
let bodyParser = require('body-parser');
let session = require('express-session');
let path = require('path');
let app = express();
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended:true}));
app.use(session({
    resave:true,
    secret:'zfpx',
    saveUninitialized:true
}));
app.set('view engine','ejs');
app.set('views',path.resolve('views'));
app.engine('html',require('ejs').__express);
let users = {};
app.get('/login',function(req,res){
  res.render('login.html');
});
app.post('/login',function(req,res){
    let body = req.body;
    users[body.username] = 100;
    req.session.username = body.username;
    res.json({code:0,data:'ç™»å½•æˆåŠŸ'});
});
app.get('/money',function(req,res){
   res.send(users[req.session.username]+"å…ƒ");
});
app.get('/withdraw',function(req,res){
    let token = req.session.token =  Math.random()+'';
    res.cookie('token',token);
    res.render('withdraw.html');
});
app.post('/withdraw',function(req,res){
    //users[req.session.username] -= (req.body.money?Number(req.body.money):10);
    //res.json({code:0,data:'å–æ¬¾æˆåŠŸ'});
    console.log(req.body.token, req.session.token)
      if(req.body.token== req.session.token){
        users[req.session.username] -= (req.body.money?parseInt(req.body.money):10);
        res.json({code:0,data:'å–æ¬¾æˆåŠŸ'});
      }else{
        res.json({code:1,data:'å–æ¬¾å¤±è´¥'});
      } 
});
app.listen(3000);

```

###### 7.3.3.2 login

```
<body>
    <a href="http://localhost:3000/money">æŸ¥çœ‹ä½™é¢</a>
    <a href="http://localhost:3000/withdraw">å–æ¬¾</a>
    ç”¨æˆ·å <input type="text" name="username" id="username">
    <button onclick="login()">æäº¤</button>
    <script>
        function ajax(method,url,data){
            let xhr = new XMLHttpRequest;
            xhr.open(method,url,true);
            xhr.setRequestHeader('Content-Type','application/json');
            xhr.onreadystatechange = function(){
                if(xhr.readyState == 4 && xhr.status == 200){
                    console.log(xhr.responseText);
                }
            }
            xhr.send(JSON.stringify(data));
        }
        function login(){
            let username = document.getElementById('username').value;
            ajax('POST','/login',{username});
        }
    </script>
</body>

```

###### 7.3.3.3 å–æ¬¾

```
<body>
    é‡‘é¢ <input type="text" name="money" id="money">
    <button onclick="login()">æäº¤</button>
    <script>
        Function.prototype.before = function(beforeFn){
            let _this = this;
            return function(){
                beforeFn.apply(this,arguments);
                return _this.apply(this,arguments);
            }
        }

        function ajax(method,url,data){
            let xhr = new XMLHttpRequest;
            xhr.open(method,url,true);
            xhr.setRequestHeader('Content-Type','application/json');
            xhr.onreadystatechange = function(){
                if(xhr.readyState == 4 && xhr.status == 200){
                    console.log(xhr.responseText);
                }
            }
            xhr.send(JSON.stringify(data));
        }
        ajax = ajax.before(function(method,url,data){
            let result = document.cookie.match(/(^|; )token=(.+?)($|; )/);
            console.log(result,result);
            data.token = result[2];
        });
        function login(){
            let money = document.getElementById('money').value;
            ajax('POST','/withdraw',{money});
        }
    </script>
</body>

```

###### 7.3.3.4 éä¿¡ä»»ç½‘ç«™

```
let express = require('express');
let path = require('path');
let app = express();
app.set('view engine','ejs');
app.set('views',path.resolve('views'));
app.engine('html',require('ejs').__express);

app.get('/',function(req,res){
  res.render('csrf.html');
});
app.get('/form',function(req,res){
  res.render('form.html');
});

app.listen(4000);

```

###### 7.3.3.5 csrf

```
<body>
    <img src="https://www.baidu.com/img/bd_logo1.png"/>
    <iframe src="/form" frameborder="0" style="width:0;height:0"></iframe>
</body>

```

###### 7.3.3.6 form

```
<body>
        <form id="myform" action="http://localhost:3000/withdraw" method="POST">
            <input type="text" name="money" id="money" value="10">
        </form>
        <script>
                setTimeout(function(){
                   document.getElementById('myform').submit();
                },100);
            </script>
</body>

```

##### 7.3.4 æ”¯æŒdecorators

-   [babel-plugin-proposal-decorators](https://babeljs.io/docs/en/babel-plugin-proposal-decorators)
    
    ```
    "plugins": [
      ["@babel/plugin-proposal-decorators", { "legacy": true }],
      ["@babel/plugin-proposal-class-properties", { "loose" : true }]
    ]
    
    ```
    
    ##### 7.3.5 ç±»decorators
    
    `` ` ``js @testable class Person{

} function testable(target) { target.testable=true; } console.log(Person.testable);

```

```js
let Hooks={
    componentWillMount() {
        console.log('componentWillMount');
    },
    componentDidMount() {
        console.log('componentDidMount');
    }
}
function mixins(...others) {
    return function (target) {
        Object.assign(target.prototype,...others);
    }
}
@mixins(Hooks)
class Component{

}
let c=new Component();
console.log(c);

```

##### 7.3.6 æ–¹æ³•decorators

-   [core-decorators](https://www.npmjs.com/package/core-decorators)

```
function readonly(target,attr,descriptor) {
    descriptor.writable=false;
}
class Circle{
    @readonly
    PI=3.14;
}
let c=new Circle();
c.PI=100;
console.log(c.PI)

```

```
function logger(target,attr,descriptor) {
    let oldVal=descriptor.value;
    descriptor.value=function (...args) {
        console.log(`å‚æ•°:${args}`);
        return oldVal(...args);
    }
}
class Caculator{
    @logger
    sum(a,b) {
        return a+b;
    }
}
let c=new Caculator();
let ret=c.sum(1,2);
console.log(ret);

```

```
let {readonly}=require('core-decorators');
function deprecate(msg,options) {
    return function (target,attr,descriptor) {
        //DEPRECATION Caculator#sum: This function will be removed in future versions.
        let oldVal=descriptor.value;
        descriptor.value=function (...args) {
            let message=msg? msg:`DEPRECATION ${target.constructor.name}#${attr}: This function will be removed in future versions.`;
            let see=options&&options.url? `see ${options.url}`:``;
            console.warn(message+'\r\n'+see);
            return oldVal(...args);
        }
    }
}
class Caculator{
    @readonly PI=3.14;
    @deprecate
    sum(a,b) {
        return a+b;
    }
    @deprecate('stop using this')
    minus(a,b) {
        return a-b;
    }
    @deprecate('stop using this',{url:'http://www.baidu.com'})
    multiply(a,b) {
        return a*b;
    }
}
let c=new Caculator();
c.PI=5;
console.log(c.PI);
let ret=c.sum(1,2);
console.log(ret);
let ret2=c.minus(2,1);
console.log(ret2);
let ret3=c.multiply(2,1);
console.log(ret3);

```

## 8.ä»£ç†æ¨¡å¼

-   ç”±äºä¸€ä¸ªå¯¹è±¡ä¸èƒ½ç›´æ¥å¼•ç”¨å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ä»£ç†å¯¹è±¡åœ¨è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹ä½œç”¨
-   å¯ä»¥åœ¨ä½¿ç”¨è€…å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´åŠ ä¸€ä¸ªä»£ç†å¯¹è±¡,é€šè¿‡ä»£ç†å¯ä»¥å®ç°æ§åˆ¶

#### 8.1 ç±»å›¾

![proxy](https://images.gitee.com/uploads/images/2019/0109/192758_e26dc7bc_1720749.jpeg)

#### 8.2 ä»£ç 

```
class Goole{
    constructor() {    }
    get() {
        return 'google';
    }
}

class Proxy {
    constructor() {
        this.google=new Goole();
    }
    get() {
        return this.google.get();
    }
}
let proxy = new Proxy();
let ret = proxy.get();
console.log(ret);

```

#### 8.3 åœºæ™¯

##### 8.3.1 äº‹ä»¶å§”æ‰˜

-   äº‹ä»¶æ•è·æŒ‡çš„æ˜¯ä»documentåˆ°è§¦å‘äº‹ä»¶çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œå³è‡ªä¸Šè€Œä¸‹çš„å»è§¦å‘äº‹ä»¶
-   äº‹ä»¶å†’æ³¡æ˜¯è‡ªä¸‹è€Œä¸Šçš„å»è§¦å‘äº‹ä»¶
-   ç»‘å®šäº‹ä»¶æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ§åˆ¶äº‹ä»¶è§¦å‘é¡ºåºæ˜¯å¦ä¸ºäº‹ä»¶æ•è·ã€‚trueä¸ºäº‹ä»¶æ•è·ï¼›falseä¸ºäº‹ä»¶å†’æ³¡,é»˜è®¤falseã€‚

```
<body>
    <ul id="list">
        <li>1</li>
        <li>2</li>
        <li>3</li>
    </ul>
<script>
  let list = document.querySelector('#list');
  list.addEventListener('click',event=>{
       alert(event.target.innerHTML);
  });     
</script>    
</body>

```

##### 8.3.2 å›¾ç‰‡æ‡’åŠ è½½

###### 8.3.2.1 app.js

```
let express=require('express');
let path=require('path')
let app=express();
app.get('/images/loading.gif',function (req,res) {
    res.sendFile(path.join(__dirname,req.path));
});
app.get('/images/:name',function (req,res) {
    setTimeout(() => {
        res.sendFile(path.join(__dirname,req.path));
    }, 2000);
});
app.get('/',function (req,res) {
    res.sendFile(path.resolve('index.html'));
});
app.listen(8080);

```

###### 8.3.2.2 index.html

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        *{
            padding:0;
            margin:0;
        }
        ul,li{
            list-style:none;
        }
        #background{
            position:absolute;
            border:1px solid green;
            right:10px;
            top:10px;
        }
        #background li{
            float:left;
            margin-left:10px;
            text-align:center;
            border:1px solid red;
            border-radius:5px;
        }
        #myImage{
            width:600px;
            height:400px;
            margin:100px auto;
        }
        #myImage img{
            width:100%;
            height:100%;
        }
    </style>
</head>
<body>
    <ul id="background">
        <li data-src="/images/bg1.jpg">å›¾ç‰‡1</li>
        <li data-src="/images/bg2.jpg">å›¾ç‰‡2</li>
    </ul>
    <div id="myImage">
    </div>
<script>
 let container = document.querySelector('#background');
 let myImage = document.querySelector('#myImage');
 let Background = (function(){
     let img = new Image();
     myImage.appendChild(img);
     return {
         set(src){
             img.src = src;
         }
     }
 })();
 let LoadingBackground = (function(){
     let img = new Image();
     img.onload = function(){
         Background.set(this.src);
     }
     return {
         set(src){ 
            Background.set(`/images/loading.gif`);
            img.src = src;
         }
     }
 })();
 container.addEventListener('click',function(event){
     let src = event.target.dataset.src;
     LoadingBackground.set(src+'?ts='+Date.now());
 });
</script>
</body>
</html>

```

-   æ›´ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™å’Œå¼€é—­åŸåˆ™

##### 8.3.3 é˜²æŠ–ä»£ç†

###### 8.3.3.1 todo.html

```
<body>
    <ul id="todos">
    </ul>
<script>
    let todos = document.querySelector('#todos');
    window.onload = function(){
        fetch('/todos').then(res=>res.json()).then(response=>{
            todos.innerHTML = response.map(item=>`<li "><input value="${item.id}" type="checkbox" ${item.completed?"checked":""}/>${item.text}</li>`).join('');
        });
    }
    function toggle(id){
       fetch(`/toggle/${id}`).then(res=>res.json()).then(response=>{
            console.log('response',response);
        });
    }
    todos.addEventListener('click',function(event){
        let checkbox = event.target;
        let id = checkbox.value;
        toggle(id);
    });
</script>
</body>

```

###### 8.3.3.2 todos.html

```
<body>
    <ul id="todos">
    </ul>
<script>
    let todos = document.querySelector('#todos');
    window.onload = function(){
        fetch('/todos').then(res=>res.json()).then(response=>{
            todos.innerHTML = response.map(item=>`<li "><input value="${item.id}" type="checkbox" ${item.completed?"checked":""}/>${item.text}</li>`).join('');
        });
    }
    function toggle(id){
       fetch(`/toggle/${id}`).then(res=>res.json()).then(response=>{
            console.log('response',response);
        });
    }
    let LazyToggle = (function(id){
        let ids = [];
        let timer;
        return function(id){
            ids.push(id);
            if(!timer){
              timer = setTimeout(function(){
                  toggle(ids.join(','));
                  ids = null;
                  clearTimeout(timer);
                  timer = null;
              },2000);
            }
        }
    })();
    todos.addEventListener('click',function(event){
        let checkbox = event.target;
        let id = checkbox.value;
        LazyToggle(id);
    });
</script>

```

###### 8.3.3.3 app.js

```
let express=require('express');
let app=express();
app.use(express.static(__dirname));
let todos=[
    {id: 1,text: 'a',completed: false},
    {id: 2,text: 'b',completed: false},
    {id: 3,text: 'c',completed: false},
];
app.get('/todos',function (req,res) {
    res.json(todos);
});
app.get('/toggle/:id',function (req,res) {
    let id=req.params.id;
    todos = todos.map(item => {
        if (item.id==id) {
            item.completed=!item.completed;
        }
        return item;
    });
    res.json({code:0});
});
app.listen(8080);

```

###### 8.3.3.4 app.js

```
app.get('/toggle/:ids',function (req,res) {
    let ids=req.params.ids;
    ids=ids.split(',').map(item=>parseInt(item));
    todos = todos.map(item => {
        if (ids.includes(item.id)) {
            item.completed=!item.completed;
        }
        return item;
    });
    res.json({code:0});
});

```

##### 8.3.4 ä»£ç†è·¨åŸŸ

###### 8.3.4.1 3000.js

```
let express=require('express');
let app=express();
app.use(express.static(__dirname));
app.listen(3000);

```

###### 8.3.4.2 4000.js

```
let express=require('express');
let app=express();
let bodyParser=require('body-parser');
app.use(bodyParser.urlencoded({extended:true}));
app.use(express.static(__dirname));
let users=[];
app.post('/register',function(req,res){
    let body=req.body;
    let target=body.target;
    let callback=body.callback;
    let username=body.username;
    let password=body.password;
    let user={username,password};
    let id=users.length==0? 1:users[users.length-1].id+1;
    user.id=id;
    users.push(user);
    res.status(302);
    res.header('Location',`${target}?callback=${callback}&args=${id}`);
    res.end();
});
app.listen(4000);

```

###### 8.3.4.3 index.html

```
<script type="text/javascript">
  function receiveId(data){
      alert('ç”¨æˆ·ID='+data);
  }
</script>
<iframe name="proxyIframe" id="proxyIframe"  frameborder="0" ></iframe>
<form action="http://localhost:4000/register" method="POST" target="proxyIframe">
   <input type="hidden" name="callback" value="receiveId">
     <input type="hidden" name="target" value="http://localhost:3000/target.html">
     ç”¨æˆ·å<input type="text" name="username"/>
     å¯†ç <input type="text" name="password"/>
     <input type="submit" value="æäº¤">
</form>

```

###### 8.3.4.4 target.html

```
window.onload = function(){
        var query = location.search.substr(1).split('&');
        let fn,args;
        for(let i=0,len=query.length;i<len;i++){
            let item = query[i].split('=');
            if(item[0]=='callback'){
                fn = item[1];
            }else if(item[0] == 'args'){
                args = item[1];
            }
        }
        try{
            eval(`top.${fn}('${args}')`);
        }catch(e){}
    }

```

##### 8.3.5 ä»£ç†ç¼“å­˜

ç¼“å­˜ä»£ç†å¯ä»¥ä¸ºå¼€é”€å¤§çš„è®¡ç®—ç»“æœæä¾›æš‚æ—¶çš„å­˜å‚¨

```
0!=1ï¼Œn!=(n-1)!Ã—n

```

```
let m = function (n) {
    if (n<=1) {
        return 1;
    } else {
        return n*m(n-1);
    }
}
function sum(n) {
    let result=0;
    for (let i=1;i<=n;i++){
        result+=m(i);
    }
    return result;
}
console.log(sum(4));

```

```
let m = function (n) {
    if (n<=1) {
        return 1;
    } else {
        return n*m(n-1);
    }
}
let sum=(function () {
    let cache={};
    return function sum(n) {
        let result=0;
        for (let i=1;i<=n;i++){
            let r=cache[i];
            if (r) {
                result+=r;
            } else {
                r=m(i);
                cache[i]=r;
                result+=r;
            }
        }
        return result;
    }
})()

console.log(sum(4));

```

##### 8.3.5 $.proxy

-   æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ–°å‡½æ•°å§‹ç»ˆä¿æŒäº†ç‰¹å®šçš„ä¸Šä¸‹æ–‡è¯­å¢ƒã€‚
-   jQuery.proxy( function, context ) functionä¸ºæ‰§è¡Œçš„å‡½æ•°ï¼Œcontentä¸ºå‡½æ•°çš„ä¸Šä¸‹æ–‡thiså€¼ä¼šè¢«è®¾ç½®æˆè¿™ä¸ªobjectå¯¹è±¡

```
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
   let btn = document.getElementById('btn');
   btn.addEventListener('click',function(){
       setTimeout($.proxy((function(){
           $(this).css('color','red');
       }),this),1000);
   });    
</script>    

```

##### 8.3.6 Proxy

-   Proxy ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸º
-   Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚Proxy è¿™ä¸ªè¯çš„åŸæ„æ˜¯ä»£ç†ï¼Œç”¨åœ¨è¿™é‡Œè¡¨ç¤ºç”±å®ƒæ¥â€œä»£ç†â€æŸäº›æ“ä½œï¼Œå¯ä»¥è¯‘ä¸ºâ€œä»£ç†å™¨â€ã€‚

```
let wang={
    name: 'wangy',
    age: 29,
    height:165
}
let wangMama=new Proxy(wang,{
    get(target,key) {
        if (key == 'age') {
            return wang.age-1;
        } else if (key == 'height') {
            return wang.height+5;
        }
        return target[key];
    },
    set(target,key,val) {
        if (key == 'boyfriend') {
            let boyfriend=val;
            if (boyfriend.age>40) {
                throw new Error('å¤ªè€');
            } else if (boyfriend.salary<20000) {
                throw new Error('å¤ªç©·');
            } else {
                target[key]=val;
                return true;
            }
        }
    }
});
console.log(wangMama.age);
console.log(wangMama.height);
wangMama.boyfriend={
    age: 41,
    salary:3000
}

```

-   ä»£ç†æ¨¡å¼ VS é€‚é…å™¨æ¨¡å¼ é€‚é…å™¨æä¾›ä¸åŒæ¥å£ï¼Œä»£ç†æ¨¡å¼æä¾›ä¸€æ¨¡ä¸€æ ·çš„æ¥å£
-   ä»£ç†æ¨¡å¼ VS è£…é¥°å™¨æ¨¡å¼ è£…é¥°å™¨æ¨¡å¼åŸæ¥çš„åŠŸèƒ½ä¸å˜è¿˜å¯ä»¥ä½¿ç”¨ï¼Œä»£ç†æ¨¡å¼æ”¹å˜åŸæ¥çš„åŠŸèƒ½

## 9\. å¤–è§‚æ¨¡å¼

è¯¥æ¨¡å¼å°±æ˜¯æŠŠä¸€äº›å¤æ‚çš„æµç¨‹å°è£…æˆä¸€ä¸ªæ¥å£ä¾›ç»™å¤–éƒ¨ç”¨æˆ·æ›´ç®€å•çš„ä½¿ç”¨

-   é—¨é¢è§’è‰²ï¼šå¤–è§‚æ¨¡å¼çš„æ ¸å¿ƒã€‚å®ƒè¢«å®¢æˆ·è§’è‰²è°ƒç”¨ï¼Œå®ƒç†Ÿæ‚‰å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚å†…éƒ¨æ ¹æ®å®¢æˆ·è§’è‰²çš„éœ€æ±‚é¢„å®šäº†å‡ ç§åŠŸèƒ½çš„ç»„åˆ
-   å­ç³»ç»Ÿè§’è‰²:å®ç°äº†å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚å®ƒå¯¹å®¢æˆ·è§’è‰²å’ŒFacadeæ—¶æœªçŸ¥çš„
-   å®¢æˆ·è§’è‰²:é€šè¿‡è°ƒç”¨Facedeæ¥å®Œæˆè¦å®ç°çš„åŠŸèƒ½

![facade22](https://images.gitee.com/uploads/images/2019/0109/192758_281c9c59_1720749.jpeg)

#### 9.1 ç±»å›¾

![facade](https://images.gitee.com/uploads/images/2019/0109/192758_519053fe_1720749.jpeg)

#### 9.2 ä»£ç 

```
class Sum{
    sum(a,b) {
        return a+b;
    }
}
class Minus{
    minus(a,b) {
        return a-b;
    }
}
class Multiply{
    multiply(a,b) {
        return a * b;
    }
}
class Calculator{
    constructor() {
        this.sumObj=new Sum();
        this.minusObj=new Minus();
        this.multiplyObj=new Multiply();
    }
    sum(...args) {
        this.sumObj.sum(...args);
    }
    minus(...args) {
        this.minusObj.minus(...args);
    }
    multiply(...args) {
        this.multiplyObj.multiply(...args);
    }
}
let calculator=new Calculator();
calculator.sum(1,2);
calculator.minus(1,2);
calculator.multiply(1,2);

```

#### 9.3 ä»£ç 

```

class CPU{
    start() {console.log('æ‰“å¼€CPU');}
}
class Memory{
    start() {console.log('æ‰“å¼€å†…å­˜');}
}
class Disk{
    start() {console.log('æ‰“å¼€ç¡¬ç›˜');}
}
class Computer{
    constructor() {
        this.cpu=new CPU();
        this.memory=new Memory();
        this.disk=new Disk();
    }
    start() {
        this.cpu.start();
        this.memory.start();
        this.disk.start();
    }
}
new Computer().start();

```

#### 9.3 åœºæ™¯

-   ä¸ºå¤æ‚çš„æ¨¡å—æˆ–å­ç³»ç»Ÿæä¾›å¤–ç•Œè®¿é—®çš„æ¨¡å—
-   å­ç³»ç»Ÿç›¸äº’ç‹¬ç«‹

##### 9.3.1 redux

-   [redux](https://github.com/reduxjs/redux/blob/master/src/index.js)

## 10.è§‚å¯Ÿè€…æ¨¡å¼

-   è¢«è§‚å¯Ÿè€…ä¾›ç»´æŠ¤è§‚å¯Ÿè€…çš„ä¸€ç³»åˆ—æ–¹æ³•
-   è§‚å¯Ÿè€…æä¾›æ›´æ–°æ¥å£
-   è§‚å¯Ÿè€…æŠŠè‡ªå·±æ³¨å†Œåˆ°è¢«è§‚å¯Ÿè€…é‡Œ
-   åœ¨è¢«è§‚å¯Ÿè€…å‘ç”Ÿå˜åŒ–æ—¶å€™ï¼Œè°ƒç”¨è§‚å¯Ÿè€…çš„æ›´æ–°æ–¹æ³•

#### 10.1 ç±»å›¾

![observer](https://images.gitee.com/uploads/images/2019/0109/192758_7fdaa324_1720749.jpeg)

#### 10.2 ä»£ç 

```
class Star{
    constructor(name) {
        this.name=name;
        this.state='';
        this.observers=[];
    }
    getState() {
        return this.state;
    }
    setState(state) {
        this.state=state;
        this.notifyAllObservers();
    }
    attach(observer) {
        this.observers.push(observer);
    }
    notifyAllObservers() {
        this.observers.forEach(observer=>observer.update());
    }
}
class Fan{
    constructor(name,subject) {
        this.name=name;
        this.subject=subject;
        this.subject.attach(this);
    }
    update() {
        console.log(`${this.subject.name}æœ‰æ–°çš„çŠ¶æ€-${this.subject.getState()},${this.name}æ­£åœ¨æ›´æ–°`);    
    }
}
let star=new Star('èµµä¸½é¢–');
let fan1=new Fan('å§œè€å¸ˆ',star);
star.setState('ç»“å©š');

```

#### 10.3 åœºæ™¯

##### 10.3.1 äº‹ä»¶ç»‘å®š

```
    <button id="btn">click</button>
    <script>
        let btn = document.getElementById('btn');
        btn.addEventListener('click',()=>{alert(1)});
        btn.addEventListener('click',()=>{alert(2)});
        btn.addEventListener('click',()=>{alert(3)});
    </script>

```

##### 10.3.2 Promise

```
class Promise{
    constructor(fn) {
        this.callbacks=[];
        let resolve=() => {
            this.callbacks.forEach(callback => callback())
        };
        fn(resolve);
    }
    then(callback) {
        this.callbacks.push(callback);
    }
}
let promise=new Promise(function (resolve,reject) {
    setTimeout(function () {
        resolve(100);
    },1000);
});
promise.then(() => console.log(1));
promise.then(() => console.log(2));

```

##### 10.3.3 callbacks

-   JQuery.Callbacksæ˜¯jQuery1.7+ä¹‹åå¼•å…¥çš„ï¼Œç”¨æ¥è¿›è¡Œå‡½æ•°é˜Ÿåˆ—çš„addã€removeã€fireã€lockç­‰æ“ä½œ
-   å¹¶æä¾›onceã€memoryã€uniqueã€stopOnFalseå››ä¸ªoptionè¿›è¡Œä¸€äº›ç‰¹æ®Šçš„æ§åˆ¶ã€‚
-   Callbackså¯¹è±¡å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°é˜Ÿåˆ—ï¼Œè·å¾—Callbackså¯¹è±¡ä¹‹å ï¼Œå°±å¯ä»¥å‘è¿™ä¸ªé›†åˆä¸­å¢åŠ æˆ–è€…åˆ é™¤å‡½æ•°ã€‚addå’ŒremoveåŠŸèƒ½ç›¸åï¼Œå‡½æ•°å‚æ•°æ˜¯ç›¸åŒçš„ï¼Œempty()åˆ é™¤å›è°ƒåˆ—è¡¨ä¸­çš„æ‰€æœ‰å‡½æ•°

```
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
 function Callbacks(){
     let observers = [];
     function add(observer){
         observers.push(observer);
     }
     function remove(observer){
         let index = observers.indexOf(observer);
         if(index != -1)
           observers.splice(index,1);
     }
     function fire(){
         observers.forEach(item=>item());
     }
     return {
         add,
         remove,
         fire
     }
 }
 let callbacks = Callbacks();

 let a1= ()=>alert(1);
 let a2= ()=>alert(2);
 let a3= ()=>alert(13);
 callbacks.add(a1);
 callbacks.add(a2);
 callbacks.add(a3);
 callbacks.remove(a3);
 callbacks.fire();
</script>

```

##### 10.3.4 events

è‡ªå®šä¹‰äº‹ä»¶

```
const EventEmitter=require('./events');
let subject=new EventEmitter();
subject.on('click',function (name) {
    console.log(1,name);
});
subject.on('click',function (name) {
    console.log(2,name);
});
subject.emit('click','zfpx');

```

events.js

```
class EventEmitter{
    constructor() {
        this._events={};
    }
    on(type,listener) {
        let listeners=this._events[type];
        if (listeners) {
            listeners.push(listener);
        } else {
            this._events[type]=[listener];
        }
    }
    emit(type) {
        let listeners=this._events[type];
        let args=Array.from(arguments).slice(1);
        listeners.forEach(listener => listener(...args));
    }
}
module.exports = EventEmitter;

```

##### 10.3.5 æµ

```
let fs=require('fs');
let rs=fs.createReadStream('./1.txt');
rs.on('data',function (data) {
    console.log(data)
});
rs.on('end',function () {
    console.log('end')
});

```

##### 10.3.6 httpæœåŠ¡å™¨

```
let http=require('http');
let server = http.createServer();
server.on('request',(req,res)=>{
  req.on('data',function(data){
      console.log(data)
  });
}));

```

##### 10.3.7 ç”Ÿå‘½å‘¨æœŸå‡½æ•°

![reactlifecycle](https://images.gitee.com/uploads/images/2019/0109/192758_ff6d2630_1720749.jpeg)

![vuelifecycle](https://images.gitee.com/uploads/images/2019/0109/192758_ac466dd3_1720749.jpeg)

##### 10.3.8 vue watch

```
<body>
<div id="root">
      <p>FullName: {{fullName}}</p>
      <p>FirstName: <input type="text" v-model="firstName"/></p>
      <p>LastName: <input type="text" v-model="lastName"/></p>
</div>
<script src="https://cdn.bootcss.com/vue/2.5.17-beta.0/vue.min.js"></script>
<script>
new Vue({
  el:'#root',
  data: {
    firstName:'å¼ ',
    lastName: 'ä¸‰',
    fullName:'å¼ ä¸‰'
  },
  watch: {
    firstName(newName, oldName) {
      this.fullName = newName + ' ' + this.lastName;
    }
  } 
})
</script>

```

##### 10.3.9 redux

-   [createStore](https://github.com/reduxjs/redux/blob/master/src/createStore.js) `` ` ``js /\*\*
    -   åˆ›å»ºä¸€ä¸ªReduxä»“åº“æ¥ä¿å­˜æ•´ä¸ªçŠ¶æ€æ ‘
    -   æ”¹å˜çŠ¶æ€æ ‘çš„å”¯ä¸€æ–¹æ³•æ˜¯è°ƒç”¨store.dispatchæ–¹æ³•
    -   åœ¨æ•´ä¸ªåº”ç”¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªä»“åº“
    -   ä¸ºäº†æŒ‡å®šçŠ¶æ€æ ‘çš„å„ä¸ªéƒ¨åˆ†å¦‚ä½•å“åº”actionçš„å˜åŒ–ï¼Œä½ å¯èƒ½ä½¿ç”¨combineReducersæ–¹æ³•æŠŠå¤šä¸ªreduceråˆå¹¶ä¸ºä¸€ä¸ªå•ç‹¬çš„reducer
    
    -   @param {Function} reducer ä¸€ä¸ªé€šè¿‡å½“å‰çŠ¶æ€å¯¹è±¡å’Œè¦å¤„ç†çš„actionè¿”å›æ–°çš„çŠ¶æ€æ ‘çš„å‡½æ•°
    -   @param {any} \[preloadedState\] åˆå§‹çŠ¶æ€ã€‚åœ¨åŒæ„åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æŒ‡å®šå®ƒä»¥åˆå¹¶æ¥è‡ªæœåŠ¡å™¨çš„çŠ¶æ€ï¼Œæˆ–è€…ä»ä¸€ä¸ªä»¥å‰åºåˆ—åŒ–çš„ç”¨æˆ·ä¼šè¯ä¸­æ¢å¤.
    -   å¦‚æœä½ ä½¿ç”¨äº†combineReducers,æ¥ä»æ ¹reducerä¸­äº§ç”ŸçŠ¶æ€ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªå’ŒcombineReducer çš„keysç›¸åŒå½¢çŠ¶çš„å¯¹è±¡
    -   @param {Function} \[enhancer\] ä»“åº“çš„enhancer. ä½ å¯èƒ½éœ€è¦æŒ‡å®šè¿™ä¸ªå»å¢å¼ºä»“åº“çš„èƒ½åŠ›ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„èƒ½åŠ›æ¯”å¦‚ä¸­é—´ä»¶
    -   æ—¶é—´æ—…è¡Œï¼ŒæŒä¹…åŒ–ç­‰ç­‰ã€‚reduxè‡ªå¸¦çš„å”¯ä¸€ä¸­é—´ä»¶æ˜¯applyMiddleware
    -   @returns {Store} æ˜¯ä¸€ä¸ªReduxä»“åº“è®©ä½ å¯ä»¥è¯»å–çŠ¶æ€ï¼Œæ´¾å‘actionå¹¶è®¢é˜…çŠ¶æ€å˜åŒ– \*/

export default function createStore(reducer,preloadedState,enhancer) { if (enhancer) { return enhancer(createStore)(reducer,preloadedState); } let state=preloadedState; let listeners=\[\]; /\*\*

```
 * è¯»å–ä»“åº“ç®¡ç†çš„çŠ¶æ€æ ‘
 * @returns {any} åº”ç”¨å½“å‰çš„çŠ¶æ€æ ‘
 */
function getState() {
    return state;
}
/**
 * å¢åŠ ä¸€ä¸ªå˜åŒ–ç›‘å¬å‡½æ•°ã€‚å®ƒå°†åœ¨ä»»ä½•æ´¾å‘åŠ¨ä½œçš„æ—¶å€™è¢«è°ƒç”¨
 * çŠ¶æ€æ ‘çš„éƒ¨åˆ†æ•°æ®å¯èƒ½ä¼šå‘ç”Ÿæ½œåœ¨çš„å˜åŒ–ã€‚ä½ å¯èƒ½åœ¨é‚£ä¸ªæ—¶å€™åœ¨å›è°ƒå‡½æ•°ä¸­è°ƒç”¨getStateæ–¹æ³•ä»¥è·å–æœ€æ–°çš„çŠ¶æ€ã€‚
 * ä½ å¯èƒ½ä¼šåœ¨ç›‘å¬å‡½æ•°é‡Œè°ƒç”¨dispatchæ–¹æ³•ï¼Œå®ƒä¼šå…·å¤‡ä»¥ä¸‹æ³¨æ„äº‹é¡¹
 * 1. è®¢é˜…ä»…ä»…åœ¨æ¯ä¸€æ¬¡è°ƒç”¨æ¯ä¸€ä¸ªdispatchæ–¹æ³•æ—¶è¢«è®°å½•å¿«ç…§
 * å¦‚æœä½ åœ¨ç›‘å¬å‡½æ•°è¢«è§¦å‘çš„æ—¶å€™è®¢é˜…æˆ–å–æ¶ˆè®¢é˜…çš„è¯ï¼Œè¿™å¯¹å½“å‰æ­£åœ¨å¤„ç†ä¸­çš„dispatchæ²¡æœ‰ä»»ä½•æ•ˆæœ
 * å°½ç®¡å¦‚æ­¤ï¼Œåœ¨ä¸‹ä¸€æ¬¡dispatchæ–¹æ³•çš„è°ƒç”¨ä¸­ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯å†…åµŒï¼Œéƒ½å°†ä½¿ç”¨ä¸€ä¸ªæœ€æ–°çš„è®¢é˜…åˆ—è¡¨
 * 
 * 2.ç›‘å¬å‡½æ•°ä¸åº”è¯¥é¢„æœŸæ‰€æœ‰çš„çŠ¶æ€å˜åŒ–ï¼Œå› ä¸ºçŠ¶æ€å¯èƒ½åœ¨dispatchä¸­è¢«æ›´æ–°å¤šæ¬¡ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œåœ¨ dispatchä¹‹å‰æ³¨å†Œçš„è®¢é˜…è€…å°†ä¼šä»¥æœ€æ–°çš„çŠ¶æ€è°ƒç”¨
 * 
 * @param {*} listener  æ¯ä¸€æ¬¡dispatchæ—¶è¢«è°ƒç”¨çš„ç›‘å¬å‡½æ•°
 * @returns {Function} è¿”å›ä¸€ä¸ªå¯ä»¥ç§»é™¤æ­¤ç›‘å¬å‡½æ•°çš„å‡½æ•°
 */
function subscribe(listener) {
    listeners.push(listener);
    return function () {
        const index=listeners.indexOf(listener);
        listeners.splice(inddx,1);
    }
}

/**
 * æ´¾å‘ä¸€ä¸ªåŠ¨ä½œï¼Œè¿™æ˜¯è§¦å‘çŠ¶æ€æ”¹å˜çš„å”¯ä¸€æ–¹å¼
 * ç”¨æ¥åˆ›å»ºä»“åº“çš„reducerå‡½æ•°å°†ä¼šè¢«è°ƒç”¨ï¼Œå‚æ•°æ˜¯å½“å‰çš„çŠ¶æ€æ ‘å’Œç»™å®šçš„åŠ¨ä½œã€‚å®ƒçš„è¿”å›å€¼å°†ä¼šè¢«å½“ä½œä¸‹ä¸€ä¸ªçŠ¶æ€æ ‘ï¼Œæ‰€æœ‰çš„ç›‘å¬å‡½æ•°ä¹Ÿä¼šè¢«é€šçŸ¥
 * 
 * åŸºæœ¬å®ç°ä¸­åªæ”¯æŒç®€å•åŠ¨ä½œå¯¹è±¡ã€‚å¦‚æœä½ æƒ³è¦æ´¾å‘ä¸€ä¸ªPromiseã€ä¸€ä¸ªObserverableã€ä¸€ä¸ªthunkæˆ–è€…å…¶å®ƒçš„ä»»ä½•æ‡‚çˆ±ï¼Œä½ éœ€è¦æŠŠä½ åˆ›å»ºä»“åº“çš„å‡½æ•°åŒ…è£¹åˆ°å¯¹åº”çš„ä¸­é—´ä»¶é‡Œã€‚
 * æ¯”å¦‚ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹redux-thunkåŒ…ã€‚ç”šè‡³ä¸­é—´ä»¶æœ€åé€šè¿‡è¿™ä¸ªæ–¹æ³•å°†ä¼šæ´¾å‘ç®€å•å¯¹è±¡ã€‚
 * 
 * 
 * @param {*} action ä¸€ä¸ªè¡¨ç¤ºå‘ç”Ÿäº†ä»€ä¹ˆçš„ç®€å•å¯¹è±¡ã€‚ä¿æŒåŠ¨ä½œåºåˆ—åŒ–å°†ä¼šæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä»¥æ–¹ä¾¿ä½ è¿›è¡Œè®°å½•å’Œå›æ”¾ç”¨æˆ·ä¼šè¯ã€‚æˆ–è€…ä½¿ç”¨æ—¶é—´æ—…è¡Œå·¥å…·redux-devtools.ä¸€ä¸ªåŠ¨ä½œå¿…é¡»æœ‰ä¸€ä¸ªtypeå±æ€§è€Œä¸”ä¸èƒ½æ˜¯undefine.ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡è¡¨ç¤ºåŠ¨ä½œç±»å‹å°†ä¼šæ˜¯ä¸ªå¥½ä¸»æ„ã€‚
 * @returns {object} ä¸ºäº†æ–¹ä¾¿ï¼Œä½ æ´¾å‘çš„ç›¸åŒçš„åŠ¨ä½œå¯¹è±¡
 * è¯·æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰ä¸­é—´ä»¶ï¼Œä½ å¯èƒ½éœ€è¦åŒ…è£¹ dispatchå»è¿”å›åˆ«çš„ä¸œè¥¿(æ¯”å¦‚ä½ ç­‰å¾…çš„Promise)
 */
function dispatch(action) {
    state=reducer(state,action);
    listeners.forEach(listener=>listener())
}
dispatch({type:'@@redux/INIT'});
return {
    dispatch,
    subscribe,
    getState
}

```

}

```

#### 10.4 è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼
##### 10.4.1 è§‚å¯Ÿè€…æ¨¡å¼(Observer)
- è®¢é˜…è€…æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ
- å½“è¯¥äº‹ä»¶è§¦å‘æ—¶å€™ï¼Œå‘å¸ƒè€…å‘å¸ƒè¯¥äº‹ä»¶åˆ°è°ƒåº¦ä¸­å¿ƒ,ç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒåº¦è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚

```js
class Agency{
    constructor() {
        this._topics={};
    }
    subscribe(topic,listener) {
        let listeners=this._topics[topic];
        if (listeners) {
            listeners.push(listener);
        } else {
            this._topics[topic]=[listener];
        }
    }
    publish(topic) {
        let listeners=this._topics[topic];
        let args=Array.from(arguments).slice(1);
        listeners.forEach(listener => listener(...args));
    }
}
let agent=new Agency();
class Landlord{
    constructor(name) {
        this.name=name;
    }
    lend(agent,area,money) {
        agent.publish('house',area,money);
    }
}

class Tenant{
    constructor(name) {
        this.name=name;
    }
    rent(agent) {
        agent.subscribe('house', (area,money)=> {
            console.log(`æœ‰æ–°æˆ¿æºäº†, ${area}å¹³ç±³, ${money}å…ƒ`);
        });
    }
}
let t1=new Tenant('æˆ¿å®¢1');
let t2=new Tenant('æˆ¿å®¢2');
let l1=new Landlord('æˆ¿ä¸œ1');
t1.rent(agent);
t2.rent(agent);
l1.lend(agent,30,2000);

```

-   è™½ç„¶ä¸¤ç§æ¨¡å¼éƒ½å­˜åœ¨è®¢é˜…è€…å’Œå‘å¸ƒè€…ï¼ˆè§‚å¯Ÿè€…å¯è®¤ä¸ºæ˜¯è®¢é˜…è€…ã€è¢«è§‚å¯Ÿè€…å¯è®¤ä¸ºæ˜¯å‘å¸ƒè€…ï¼‰
-   ä½†æ˜¯è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ç”±è¢«è§‚å¯Ÿè€…è°ƒåº¦çš„ï¼Œè€Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼æ˜¯ç»Ÿä¸€ç”±è°ƒåº¦ä¸­å¿ƒè°ƒçš„
-   æ‰€ä»¥è§‚å¯Ÿè€…æ¨¡å¼çš„è®¢é˜…è€…ä¸å‘å¸ƒè€…ä¹‹é—´æ˜¯å­˜åœ¨ä¾èµ–çš„ï¼Œè€Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼åˆ™ä¸ä¼šã€‚

## 11\. è¿­ä»£å™¨æ¨¡å¼

-   é¡ºåºè®¿é—®ä¸€ä¸ªé›†åˆ
-   ä½¿ç”¨è€…æ— éœ€çŸ¥é“é›†åˆçš„å†…éƒ¨æ•°æ®ç»“æ„

### 11.1 ç±»å›¾

![iterator](https://images.gitee.com/uploads/images/2019/0109/192758_27475743_1720749.jpeg)

### 11.2 ä»£ç 

```
function createIterator(arr) {
    let index=0;
    return {
        next() {
            return index<arr.length?
                {value: arr[index++],done: false}:
                {done:true}
        }
    }
}
let it=createIterator([1,2]);
console.log(it.next());
console.log(it.next());
console.log(it.next());

```

### 11.3 åœºæ™¯

#### 11.3.1 Iterator

-   åœ¨ES6ä¸­æœ‰åºé›†åˆæ•°æ®ç±»å‹æœ‰Arrayã€Mapã€Setã€Stringã€TypedArrayã€argumentsã€NodeList
-   æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªç»Ÿä¸€çš„éå†æ¥å£æ¥éå†æ‰€æœ‰çš„æ•°æ®ç±»å‹
-   ä»–ä»¬éƒ½æœ‰ \[Symbol.Iterator\]å±æ€§ï¼Œå±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°ä¼šè¿”å›è¿­ä»£å™¨
-   è¿­ä»£å™¨å°±æœ‰nextæ–¹æ³•é¡ºåºè¿”å›å­å…ƒç´ 
    
    ```
    Array.prototype[Symbol.iterator]=function () {
      let index=0;
      return {
          next:()=> {
              return index<this.length?
                  {value: this[index++],done: false}:
                  {done:true}
          }
      }
    }
    let arr=[1,2];
    let it=arr[Symbol.iterator]();
    console.log(it.next());
    console.log(it.next());
    console.log(it.next());
    
    ```
    

```
let result={};
while (!result.done) {
    result=it.next();
    console.log(result);
}

```

```
for (let item of arr) {
    console.log(item);
}

```

#### 11.3.2 ...

è§£æ„èµ‹å€¼

```
let arr = [1,2];
let [x,y] = arr;
let arr2 = [1, ...arr];

```

#### 11.3.3 yield\*

yield\*åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå¯éå†çš„ç»“æ„ï¼Œå®ƒä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£ã€‚

```
let generator = function* () {
    yield 1;
    yield* [2,3,4];
    yield 5;
  };

var iterator = generator();

console.log(iterator.next()); // { value: 1, done: false }
console.log(iterator.next()); // { value: 2, done: false }
console.log(iterator.next());// { value: 3, done: false }
console.log(iterator.next()); // { value: 4, done: false }
console.log(iterator.next()); // { value: 5, done: false }
console.log(iterator.next()); // { value: undefined, done: true }

```

### 12\. çŠ¶æ€æ¨¡å¼

-   å½“ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå¯¼è‡´å…¶è¡Œä¸ºçš„æ”¹å˜ï¼Œè¿™çœ‹èµ·æ¥åƒæ˜¯æ”¹å˜äº†å¯¹è±¡
-   å¯¹è±¡æœ‰è‡ªå·±çš„çŠ¶æ€
-   ä¸åŒçŠ¶æ€ä¸‹æ‰§è¡Œçš„é€»è¾‘ä¸ä¸€æ ·
-   æ˜ç¡®çŠ¶æ€å’Œæ¯ä¸ªçŠ¶æ€ä¸‹æ‰§è¡Œçš„åŠ¨ä½œ
-   ç”¨æ¥å‡å°‘`if...else`å­å¥

### 12.1 ç±»å›¾

![state](https://images.gitee.com/uploads/images/2019/0109/192758_c048eb45_1720749.jpeg)

### 12.2 ä»£ç 

```
class Battery{
    constructor() {
        this.amount='high';
    }
    show() {
        if (this.amount == 'high') {
            console.log('ç»¿è‰²');
            this.amount='middle';
        }else if (this.amount == 'middle') {
            console.log('é»„è‰²');
            this.amount='low';
        }else{
            console.log('çº¢è‰²');
        }
    }
}
let battery=new Battery();
battery.show();
battery.show();
battery.show();

```

-   `show`è¿åå¼€æ”¾-å°é—­åŸåˆ™
-   `show`æ–¹æ³•é€»è¾‘å¤ªå¤šå¤ªå¤æ‚
-   é¢œè‰²çŠ¶æ€åˆ‡æ¢ä¸æ˜æ˜¾
-   è¿‡å¤šçš„ `if/else` è®©ä»£ç ä¸å¯ç»´æŠ¤

```
class Battery {
    constructor(state) {
        this.amount = 'high';
        this.state = new SuccessState();
    }
    show() {
        this.state.show();
        if (this.amount == 'high') {
            this.amount='middle';
            this.setState(new WarningState());
        } else if(this.amount=='middle'){
            this.amount='low';
            this.setState(new DangerState());
        }
    }
    setState(state) {
        this.state = state;
    }
}
class SuccessState {
    constructor(battery){
        this.battery = battery;
    }
    show() {
        console.log(`ç»¿è‰² ${battery.amount}`);

  }
}
class WarningState {
    constructor(battery){
        this.battery = battery;
    }
    show() {
        console.log(`é»„è‰² ${battery.amount}`);
  }
}
class DangerState {
    constructor(battery){
        this.battery = battery;
    }
    show() {
        console.log(`çº¢è‰² ${battery.amount}`);
  }
}

let battery=new Battery();
battery.show();
battery.show();
battery.show();

```

### 12.3 åº”ç”¨åœºæ™¯

#### 12.3.1 ç‚¹èµ

```
let likeState={
    render(element) {
        element.innerHTML='èµğŸ‘';
    }
}
let likedState={
    render(element) {
        element.innerHTML='å–æ¶ˆ';
    }
}

class Button{
    constructor(container) {
        this.liked=false;
        this.state = likeState;
        this.element=document.createElement('button');
        container.appendChild(this.element);
        this.render();
    }
    setState(state) {
        this.state=state;
        this.render();
    }
    render() {
        this.state.render(this.element);
    }
}

let button=new Button(document.body);
button.element.addEventListener('click',() => {
    button.setState(button.liked? likeState:likedState);
    button.liked=!button.liked;
});

```

#### 12.3.2 promise

```
class Promise{
    constructor(fn) {
        this.state='initial';
        this.successes=[];
        this.fails=[];
        let resolve=(data) => {
            this.state='fulfilled';
            this.successes.forEach(item=>item(data));
        }
        let reject=(error) => {
            this.state='failed';
            this.fails.forEach(item=>item(error));
        }
        fn(resolve,reject);
    }
    then(success,fail) {
        this.successes.push(success);
        this.fails.push(fail);
    }
}
let p=new Promise(function (resolve,reject) {
    setTimeout(function () {
        resolve(1);
    },1000);
});
p.then((data)=>console.log('æˆåŠŸ'),error=>console.error('å¤±è´¥'));

```

#### 12.3.3 Reactå¯¼èˆª

-   [codepen.io](https://codepen.io/zhufengnodejs/pen/LXogOy)
    
    ```
    const States = {
    'show':function(){
      console.log("banneræ˜¾ç¤ºï¼Œç‚¹å‡»å¯ä»¥å…³é—­");
      this.setState({
        currentState: "hide"
      })
    },
    'hide':function(){
        console.log("banneréšè—ï¼Œç‚¹å‡»å¯ä»¥æ‰“å¼€");
        this.setState({
          currentState: "show"
        })
    }
    }
    class Banner extends React.Component{
    state={currentState:'show'}
    toggle = ()=>{
      let s = this.state.currentState;
      States[s] && States[s].apply(this);
    }
    render(){
      return (
        <div>
          {this.state.currentState=='show'&&<nav>å¯¼èˆª</nav>}
          <button onClick={this.toggle}>éšè—</button>
        </div>
      )
    }
    }
    ReactDOM.render(<Banner/>,document.getElementById('root'));
    
    ```
    

#### 12.3.4 æœ‰é™çŠ¶æ€æœº

-   äº‹ç‰©æ‹¥æœ‰å¤šç§çŠ¶æ€ï¼Œä»»ä¸€æ—¶é—´åªä¼šå¤„äºä¸€ç§çŠ¶æ€ä¸ä¼šå¤„äºå¤šç§çŠ¶æ€ï¼›
-   åŠ¨ä½œå¯ä»¥æ”¹å˜äº‹ç‰©çŠ¶æ€ï¼Œä¸€ä¸ªåŠ¨ä½œå¯ä»¥é€šè¿‡æ¡ä»¶åˆ¤æ–­ï¼Œæ”¹å˜äº‹ç‰©åˆ°ä¸åŒçš„çŠ¶æ€ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶æŒ‡å‘å¤šä¸ªçŠ¶æ€ï¼Œä¸€ä¸ªæ—¶é—´ï¼Œå°±ä¸€ä¸ªçŠ¶æ€
-   çŠ¶æ€æ€»æ•°æ˜¯æœ‰é™çš„ï¼›
-   [javascript-state-machine](https://github.com/jakesgordon/javascript-state-machine)
    -   formï¼šå½“å‰è¡Œä¸ºä»å“ªä¸ªçŠ¶æ€æ¥
    -   to:å½“å‰è¡Œä¸ºæ‰§è¡Œå®Œä¼šè¿‡æ¸¡åˆ°å“ªä¸ªçŠ¶æ€
    -   name:å½“å‰è¡Œä¸ºçš„åå­—
-   fsm.can(t) - return true å¦‚æœè¿‡æ¸¡æ–¹æ³•tå¯ä»¥ä»å½“å‰çŠ¶æ€è§¦å‘
-   fsm.cannot(t) - return true å¦‚æœå½“å‰çŠ¶æ€ä¸‹ä¸èƒ½å‘ç”Ÿè¿‡æ¸¡æ–¹æ³•t
-   fsm.transitions() - è¿”å›ä»å½“å‰çŠ¶æ€å¯ä»¥è¿‡æ¸¡åˆ°çš„çŠ¶æ€çš„åˆ—è¡¨
-   fsm.allTransitions() - è¿”å›æ‰€æœ‰è¿‡æ¸¡æ–¹æ³•çš„åˆ—è¡¨
-   fsm.allStates() - è¿”å›çŠ¶æ€æœºæœ‰çš„æ‰€æœ‰çŠ¶æ€çš„åˆ—è¡¨
-   onBefore åœ¨ç‰¹å®šåŠ¨ä½œTRANSITIONå‰è§¦å‘
-   onLeaveState ç¦»å¼€ä»»ä½•ä¸€ä¸ªçŠ¶æ€çš„æ—¶å€™è§¦å‘
-   onLeave åœ¨ç¦»å¼€ç‰¹å®šçŠ¶æ€STATEæ—¶è§¦å‘
-   onTransition åœ¨ä»»ä½•åŠ¨ä½œå‘ç”ŸæœŸé—´è§¦å‘
-   onEnterState å½“è¿›å…¥ä»»ä½•çŠ¶æ€æ—¶è§¦å‘
-   onEnter è¿›å…¥ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€STATEæ—¶è§¦å‘
-   on onEnterçš„ç®€å†™
-   onAfterTransition ä»»ä½•åŠ¨ä½œè§¦å‘åè§¦å‘
-   onAfter åœ¨ç‰¹å®šåŠ¨ä½œTRANSITIONåè§¦å‘
-   on onAfterçš„ç®€å†™

```
//æœ‰é™çŠ¶æ€æœº Finite-state machine
var StateMachine = require('javascript-state-machine');
//æœ‰é™çŠ¶æ€æœº Finite-state machine
//var StateMachine=require('javascript-state-machine');
class StateMachine {
    constructor(options) {
        let {init,transitions,methods} =options;
        this.state=init;
        transitions.forEach(transition => {
            let {from,to,name}=transition;
            this[name]=function () {
                if (this.state == from) {
                    this.state=to;
                    let onMethod='on'+name.slice(0,1).toUpperCase()+name.slice(1);
                    methods[onMethod]&&methods[onMethod]();
                }
            }
        });
    }
}
var fsm = new StateMachine({
    init: 'solid',
    transitions: [{
            name: 'melt',
            from: 'solid',
            to: 'liquid'
        },
        {
            name: 'freeze',
            from: 'liquid',
            to: 'solid'
        },
        {
            name: 'vaporize',
            from: 'liquid',
            to: 'gas'
        },
        {
            name: 'condense',
            from: 'gas',
            to: 'liquid'
        }
    ],
    methods: {
        onMelt: function () {
            console.log('I melted')
        },
        onFreeze: function () {
            console.log('I froze')
        },
        onVaporize: function () {
            console.log('I vaporized')
        },
        onCondense: function () {
            console.log('I condensed')
        }
    }
});
fsm.melt();

```

## 13.ç­–ç•¥æ¨¡å¼

-   å°†å®šä¹‰çš„ä¸€ç»„ç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å…¶ç›¸äº’ä¹‹é—´å¯ä»¥æ›¿æ¢ã€‚å°è£…çš„ç®—æ³•å…·æœ‰ä¸€å®šç‹¬ç«‹æ€§ï¼Œä¸ä¼šéšå®¢æˆ·ç«¯å˜åŒ–è€Œå˜åŒ–ã€‚
-   é¿å…å¤§é‡çš„if else æˆ– swith case

### 13.1 ç±»å›¾

![strategy](https://images.gitee.com/uploads/images/2019/0109/192758_cccc2ab0_1720749.jpeg)

### 13.2 ä»£ç 

```
class Customer{
    constructor(type) {
        this.type=type;
    }
    pay(amount) {
        if (this.type == 'ä¼šå‘˜é¡¾å®¢') {
            return amount*.9;
        }else if (this.type == 'VIPé¡¾å®¢') {
            return amount*.8;
        } 
        return amount;
    }
}
let c1=new Customer('æ™®é€šé¡¾å®¢');
console.log(c1.pay(100));
let c2=new Customer('ä¼šå‘˜é¡¾å®¢');
console.log(c2.pay(100));
let c3=new Customer('VIPé¡¾å®¢');
console.log(c3.pay(100));

```

```
class Customer{
    constructor(kind) {
        this.kind=kind;
    }
    cost(amount) {
        return this.kind.discount(amount);
    }
}
class Kind{

}
class Normal extends Kind{
    discount(amount) {
        return amount;
    }
}
class Member extends Kind{
    discount(amount) {
        return amount*.9;
    }
}
class VIP extends Kind{
    discount(amount) {
        return amount*.8;
    }
}
let c1=new Customer(new Normal());
console.log(c1.cost(100));
c1.kind=new Member();
console.log(c1.cost(100));
c1.kind=new VIP();
console.log(c1.cost(100));

```

æŠŠç®—æ³•å°è£…åœ¨ç­–ç•¥å¯¹è±¡ä¸­ï¼ŒæŒ‡å®šç®—æ³•è°ƒç”¨å³å¯

```
class Customer{
    constructor() {
        this.kinds={
            normal: function (price) {
                return price;
            },
            member: function (price) {
                return price*.9;
            },
            vip: function (price) {
                return price*.8;
            }
        }
    }
    cost(kind,amount) {
        return this.kinds[kind](amount);
    }
}
let c=new Customer();
console.log(c.cost('normal',100));
console.log(c.cost('member',100));
console.log(c.cost('vip',100));

```

### 13.3 åº”ç”¨åœºæ™¯

#### 13.3.1 animate

-   animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
-   è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
-   `$(selector).animate(styles,speed,easing,callback)`
    -   swing åŠ¨ç”»çš„å¼€å§‹å˜å¾—æ›´åŠ å¿«ä¸€äº›ï¼Œç„¶åå†æ…¢ä¸‹æ¥
    -   linear æ–¹æ³•æä¾›äº†ä¸€ä¸ªç¨³å®šçš„åŠ¨ç”»ï¼Œä»¥ä½¿å¾—åŠ¨ç”»çš„æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ç›¸åŒçš„

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
      #content{
          width:100px;
          height:100px;
          background-color:green;
      }
    </style>
</head>
<body>
<div id="content"></div>
<button id="bigger">å˜å¤§</button>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
$('#bigger').click(function(){
    $('#content').animate({width:'200px',height:'200px'},1000,'linear');
});
</script>
</body>
</html>

```

#### 13.3.2 è¡¨å•æ ¡éªŒ

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <form  id="userform">
      ç”¨æˆ·å <input type="text" name="username"/>
      å¯†ç  <input type="text" name="password"/>
      æ‰‹æœºå· <input type="text" name="mobile"/>
      <input type="submit">
    </form>
<script>
let Validator = (function(){
    let rules = {
        notEmpty(val,msg){
            if(val == ''){
                return msg;
            }
        },
        minLength(val,length,msg){
            if(val==''||val.length <length){
                return msg;
            }
        },
        maxLength(val,length,msg){
            if(val==''||val.length > length){
                return msg;
            }
        },
        isMobile(val,msg){
            if(!/^1\d{10}/.test(val)){
                return msg;
            }
        }
    }
    function addRule(name,rule){
        rules[name] = rule;
    }
    let checks = [];
    function add(element,rule){
        checks.push(function(){
            let name = rule.shift();
            rule.unshift(element.value);
            return rules[name]&&rules[name].apply(element,rule);
        });
    }
    function start(){
        for(let i=0;i<checks.length;i++){
            let check = checks[i];
            let msg = check();
            if(msg){
                return msg;
            }
        }
    }
    return {
        add,
        start,
        addRule
    }
})();

let form = document.getElementById('userform');
form.onsubmit = function(){
    Validator.add(form.username,['notEmpty','ç”¨æˆ·åä¸èƒ½ä¸ºç©º']);
    Validator.add(form.password,['minLength',6,'å¯†ç å°äº6ä½æœ€å°‘é•¿åº¦']);
    Validator.add(form.password,['maxLength',8,'å¯†ç å¤§äº8ä½æœ€å¤§é•¿åº¦']);
    Validator.add(form.mobile,['isMobile','æ‰‹æœºå·ä¸åˆæ³•']);
    let msg =   Validator.start();
    if(msg) {
        alert(msg);
        return false;
    }
    alert('æ ¡éªŒé€šè¿‡');
    return true;
}
</script>

</body>
</html>

```

-   ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼éƒ½æœ‰ä¸Šä¸‹æ–‡ï¼Œæœ‰ç­–ç•¥æˆ–è€…çŠ¶æ€ç±»ï¼Œä¸Šä¸‹æ–‡æŠŠè¿™äº›è¯·æ±‚å§”æ‰˜ç»™è¿™äº›ç±»æ¥æ‰§è¡Œ
-   ç­–ç•¥æ¨¡å¼ä¸­å„ä¸ªç±»æ˜¯å¹³ç­‰çš„ï¼Œæ²¡æœ‰å…³ç³»ï¼Œå®¢æˆ·ç«¯éœ€è¦çŸ¥é“ç®—æ³•ä¸»åŠ¨åˆ‡æ¢ï¼ŒçŠ¶æ€æ¨¡å¼ä¸­ï¼ŒçŠ¶æ€çš„åˆ‡æ¢å’Œè¡Œä¸ºè¢«å°è£…å¥½äº†ï¼Œå®¢æˆ·ä¸éœ€è¦äº†è§£ç»†èŠ‚ã€‚

## 14\. åŸå‹æ¨¡å¼

-   åŸå‹æ¨¡å¼æ˜¯ä¸€ä¸ªåˆ›å»ºå‹çš„æ¨¡å¼
-   åˆ›å»ºåŸºç±»çš„æ—¶å€™ï¼Œç®€å•å·®å¼‚åŒ–çš„å±æ€§æ”¾åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæ¶ˆè€—èµ„æºç›¸åŒçš„åŠŸèƒ½æ”¾åœ¨åŸºç±»åŸå‹ä¸­

### 14.1 ç±»å›¾

![myprototype](https://images.gitee.com/uploads/images/2019/0109/192758_40ff81b7_1720749.jpeg)

### 14.2 ä»£ç 

```
function Person(name) {
    this.name=name;
    this.getName=function () {
        console.log(this.name);
    }
}
let p1 = new Person('å¼ ä¸‰');
let p2=new Person('æå››');
console.log(p1.getName===p2.getName);

```

```
function Person(name) {
    this.name=name;
}
Person.prototype.getName = function () {
    console.log(this.name);
}
let p1 = new Person('å¼ ä¸‰');
let p2=new Person('æå››');
console.log(p1.getName===p2.getName);

```

### 14.3 JavaScriptä¸­çš„åŸå‹

#### 14.3.1 å‡½æ•°å’Œå¯¹è±¡

-   å‡½æ•°æ˜¯ä¸€ç§å¯¹è±¡
-   å¯¹è±¡éƒ½æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„

```
//å‡½æ•°æ˜¯ä¸€ç§å¯¹è±¡
function Person() {}
console.log(Person instanceof Object);

//å¯¹è±¡éƒ½æ˜¯é€šè¿‡å‡½æ•°åˆ›å»ºçš„
let p1=new Person();
let obj1={name: 'zfpx'}
let obj=new Object();
obj2.name='zfpx';

```

#### 14.3.2 prototype

-   æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªå±æ€§å«åš`prototype`
-   `prototype`çš„å±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡,é»˜è®¤çš„åªæœ‰ä¸€ä¸ªå«åš`constructor`çš„å±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå‡½æ•°æœ¬èº«
-   æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªéšè—çš„å±æ€§`__proto__`,è¿™ä¸ªå±æ€§å¼•ç”¨äº†åˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„å‡½æ•°çš„`prototype`

![__proto__](https://images.gitee.com/uploads/images/2019/0109/192758_82db32b7_1720749.png)

-   è‡ªå®šä¹‰å‡½æ•°çš„prototypeæ˜¯ç”±Objectåˆ›å»ºï¼Œæ‰€ä»¥å®ƒçš„**proto**æŒ‡å‘çš„å°±æ˜¯Object.prototype
-   Object.prototypeçš„**proto**æŒ‡å‘çš„æ˜¯null

![object.prototype](https://images.gitee.com/uploads/images/2019/0109/192758_c8e0b1cf_1720749.png)

-   è‡ªå®šä¹‰å‡½æ•°`Foo.__proto__`æŒ‡å‘Function.prototype
-   `Object.__proto__`æŒ‡å‘Function.prototype
-   `Function.__proto__`æŒ‡å‘Function.prototype
    
    ```
    let sum = new Function('a','b','return a+b');
    
    ```
    

![function.prototype](https://images.gitee.com/uploads/images/2019/0109/192759_01cd602d_1720749.png)

-   Function.prototypeçš„**proto**ä¹ŸæŒ‡å‘Object.prototype

![function.prototype.__proto__](https://images.gitee.com/uploads/images/2019/0109/192759_a5a04401_1720749.png)

#### 14.3.3 instanceof

-   Instanceofè¿ç®—ç¬¦çš„ç¬¬ä¸€ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæš‚æ—¶ç§°ä¸ºAï¼›ç¬¬äºŒä¸ªå˜é‡ä¸€èˆ¬æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæš‚æ—¶ç§°ä¸ºB
-   Instanceofçš„åˆ¤æ–­è§„åˆ™æ˜¯ï¼šæ²¿ç€Açš„`__proto__`è¿™æ¡çº¿æ¥æ‰¾ï¼ŒåŒæ—¶æ²¿ç€Bçš„`prototype`è¿™æ¡çº¿æ¥æ‰¾ï¼Œå¦‚æœä¸¤æ¡çº¿èƒ½æ‰¾åˆ°åŒä¸€ä¸ªå¼•ç”¨ï¼Œå³åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±è¿”å›`true`ã€‚å¦‚æœæ‰¾åˆ°ç»ˆç‚¹è¿˜æœªé‡åˆï¼Œåˆ™è¿”å›`false`ã€‚
    
    ```
    console.log(Object instanceof Function);
    console.log(Function instanceof Object);
    console.log(Function instanceof Function);
    
    ```
    

![fullprototype](https://images.gitee.com/uploads/images/2019/0109/192759_a727097d_1720749.png)

#### 14.3.4 åŸå‹é“¾

-   è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå…ˆåœ¨åŸºæœ¬å±æ€§ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†æ²¿ç€**proto**è¿™æ¡é“¾å‘ä¸Šæ‰¾ï¼Œè¿™å°±æ˜¯åŸå‹é“¾
-   `hasOwnProperty`å¯ä»¥åŒºåˆ†ä¸€ä¸ªå±æ€§åˆ°åº•æ˜¯è‡ªå·±çš„è¿˜æ˜¯ä»åŸå‹ä¸­æ‰¾åˆ°

```
function Foo(){
    this.a = 10;
}
Foo.prototype.b = 20;

let f1  = new Foo();
console.log(f1.a);
console.log(f1.b);

```

#### 14.3.5 åŸå‹ä¼˜åŠ¿

-   å¯ä»¥éšæ„æ‰©å±•
-   å¯ä»¥é‡å†™ç»§æ‰¿çš„æ–¹æ³•

```
let obj = {};
console.log(obj.toString());
let arr = [1,2,3];
console.log(arr.toString());

```

### 14.4 åœºæ™¯

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin:0;
            padding:0;
        }
        canvas{
            border:1px solid #000;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="1000" height="600"></canvas>
    <script>
    //éšæœºé¢œè‰²ï¼Œåå…­è¿›åˆ¶æ–¹æ³•ï¼›
        function getRandomColor( ) {
          var rand = Math.floor(Math.random( ) * 0xFFFFFF).toString(16);
          if(rand.length == 6){        
            return '#'+rand;
          }else{
            return getRandomColor();
          }
        }
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let circles = [];
        function Circle(x,y,radius){
                this.x=x;
                this.y=y;
                this.radius= radius;
                circles.push(this);
        }
        Circle.prototype.update = function() {
                this.radius--;
                if(this.radius>0){
                    return true;
                }
        }
        Circle.prototype.render = function(){
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.radius,0,2*Math.PI);
            ctx.fillStyle = getRandomColor();
            ctx.fill();
        }

        let circle = new Circle(0,0,30);
        canvas.onmousemove = function(event){
            circles.push(new Circle(event.clientX,event.clientY,30));
        }
        setInterval(function(){
            ctx.clearRect(0,0,1000,600);
            circles.forEach(item=>{
                item.update()&&item.render(); 
            });
            circles = circles.filter(item=>item.radius>0);
        },20);
    </script>
</body>
</html>

```

## 15\. æ¡¥æ¥æ¨¡å¼

-   å°†æŠ½è±¡éƒ¨åˆ†ä¸ä»–çš„å®ç°éƒ¨åˆ†åˆ†ç¦»,è¿™æ ·æŠ½è±¡åŒ–ä¸å®ç°åŒ–è§£è€¦,ä½¿ä»–ä»¬å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–
-   åº”ç”¨åœºæ™¯æ˜¯å®ç°ç³»ç»Ÿå¯èƒ½æœ‰å¤šä¸ªè§’åº¦åˆ†ç±»,æ¯ä¸€ç§è§’åº¦éƒ½å¯èƒ½å˜åŒ–.
-   æ¡¥æ–¹å¯ä»¥é€šè¿‡å®ç°æ¡¥æ¥å£è¿›è¡Œå•æ–¹é¢æ‰©å±•ï¼Œè€Œå¦ä¸€æ–¹å¯ä»¥ç»§æ‰¿æŠ½è±¡ç±»è€Œå•æ–¹é¢æ‰©å±•ï¼Œè€Œä¹‹é—´çš„è°ƒç”¨å°±ä»æ¡¥æ¥å£æ¥ä½œä¸ºçªç ´å£ï¼Œä¸ä¼šå—åˆ°åŒæ–¹æ‰©å±•çš„ä»»ä½•å½±å“

### 15.1 ç±»å›¾

![bridge](https://images.gitee.com/uploads/images/2019/0109/192759_03de8d50_1720749.jpeg)

### 15.2 ä»£ç 

```
class A {
    constructor(bridge) {
        this.bridge=bridge;
    }
    go() {
        console.log(`ä»${this.from()}åˆ°${this.bridge.to()}`);
    }
}
class A1 extends A {
    from() {
        return 'A1';
    }
}
class A2 extends A {
    from() {
        return 'A2';
    }
}
class A3 extends A {
    from() {
        return 'A3';
    }
}

class B {
    to() {}
}
class B1 extends B {
    to() {
        return 'B1';
    }
}
class B2 extends B {
    to() {
        return 'B2';
    }
}
class B3 extends B {
    to() {
        return 'B3';
    }
}
let b=new B3();
let a=new A2(b);
a.go();

```

### 15.3 åº”ç”¨åœºæ™¯

#### 15.3.1 äº‹ä»¶ç›‘å¬

```
let express=require('express');
let path=require('path');
let app=express();
app.get('/',(req,res) => {
    res.sendFile(path.join(__dirname,'4.html'));
});
app.get('/user/:id',function (req,res) {
    let id = req.params.id;
    res.json({id,name:`${id}_name`});
});
app.listen(8888);

```

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>bridage</title>
</head>
<body>
    <ul>
      <li data-id="1" >1</li>
      <li data-id="2" >2</li>
    </ul>
    <p id="content">

    </p>
<script>
  let lis = document.querySelectorAll('li');
  for(let i=0;i<lis.length;i++){
      lis[i].addEventListener('click',getUserById);
  }
  function getUserById(event){
      let id = this.dataset.id;
      let xhr = new XMLHttpRequest;
      xhr.open('GET',`/user/${id}`,true);
      xhr.responseType = 'json';
      xhr.onreadystatechange = function(){
          if(xhr.readyState ===4 && xhr.status == 200){
            let user = xhr.response;
            document.getElementById('content').innerHTML = user.name;
          }
      }
      xhr.send();
  }

  function getUserById(id,callback){
      let id = this.dataset.id;
      let xhr = new XMLHttpRequest;
      xhr.open('GET',`/user/${id}`,true);
      xhr.responseType = 'json';
      xhr.onreadystatechange = function(){
          if(xhr.readyState ===4 && xhr.status == 200){
            let user = xhr.response;
            document.getElementById('content').innerHTML = user.name;
          }
      }
      xhr.send();
  }
</script>    
</body>
</html>

```

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <ul>
      <li data-id="1" >1</li>
      <li data-id="2" >2</li>
    </ul>
    <p id="content">

    </p>
<script>
  let lis = document.querySelectorAll('li');
  for(let i=0;i<lis.length;i++){
      lis[i].addEventListener('click',addBridage);
  }
  function getUserById(event){
      let id = this.dataset.id;
      let xhr = new XMLHttpRequest;
      xhr.open('GET',`/user/${id}`,true);
      xhr.responseType = 'json';
      xhr.onreadystatechange = function(){
          if(xhr.readyState ===4 && xhr.status == 200){
            let user = xhr.response;
             document.getElementById('content').innerHTML = user.name;
          }
      }
      xhr.send();
  }

  function addBridage(){
      let id = this.dataset.id;
      getUserById(id,function(user){
         document.getElementById('content').innerHTML = user.name;
      });
  }

  function getUserById(id,callback){
      let xhr = new XMLHttpRequest;
      xhr.open('GET',`/user/${id}`,true);
      xhr.responseType = 'json';
      xhr.onreadystatechange = function(){
          if(xhr.readyState ===4 && xhr.status == 200){
            let user = xhr.response;
            callback(user);
          }
      }
      xhr.send();
  }
</script>    
</body>
</html>

```

#### 15.3.2 åˆ†ç¦»å˜åŒ–

-   åˆ†ç¦»å¤šç»´å˜åŒ–

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>html</title>
    <style>
        * {
            margin:0;
            padding:0;
        }
        canvas{
            border:1px solid #000;
        }
    </style>
</head>
<body>
<canvas id="canvas" width="600" height="600"></canvas>
<script>
//å½¢çŠ¶ é¢œè‰² åæ ‡
function Position(x,y) {
  this.x=x;
  this.y=y;
}

function Color(color) {
    this.color=color;
}


function Ball(x,y,color) {
    this.position=new Position(x,y);
    this.color=new Color(color);
}
Ball.prototype.draw=function () {
  let canvas = document.getElementById('canvas');
  let ctx = canvas.getContext('2d');
  ctx.beginPath();
  ctx.arc(this.position.x,this.position.y,100,0,2*Math.PI);
  ctx.fillStyle = this.color.color;
  ctx.fill();
}
new Ball(300,300,'red').draw();
</script>    
</body>
</html>

```

## 16\. ç»„åˆæ¨¡å¼

-   åˆç§°æ•´ä½“-éƒ¨åˆ†æ¨¡å¼
-   å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºéƒ¨åˆ†-æ•´ä½“çš„å±‚æ¬¡ç»“æ„
-   å®¢æˆ·å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„æ–¹å¼å¯¹å¾…ç»„åˆå¯¹è±¡å’Œå¶å­å¯¹è±¡

### 16.1 ç±»å›¾

![compose](https://images.gitee.com/uploads/images/2019/0109/192759_5fb1222e_1720749.jpeg)

### 16.2 ä»£ç 

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <style>
    .red{
        color:red;
    }
    </style>
</head>
<body>
<div id="root"></div>    
<script>
function ReactElement(type,props) {
    this.type = type;
    this.props = props;
}
let React = {
    createElement(type,props={},...childrens){
        childrens.length===1?childrens = childrens[0]:void 0
        return new ReactElement(type,{...props,children:childrens})
    }
};
let render = (eleObj,container)=>{
    // å…ˆå–å‡ºç¬¬ä¸€å±‚ è¿›è¡Œåˆ›å»ºçœŸå®dom
    let {type,props} = eleObj;
    let elementNode = document.createElement(type); // åˆ›å»ºç¬¬ä¸€ä¸ªå…ƒç´ 
    for(let attr in props){ // å¾ªç¯æ‰€æœ‰å±æ€§
        if(attr === 'children'){ // å¦‚æœæ˜¯childrenè¡¨ç¤ºæœ‰åµŒå¥—å…³ç³»
            if(typeof props[attr] == 'object'){ // çœ‹æ˜¯å¦æ˜¯åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹
                props[attr].forEach(item=>{ // å¤šä¸ªçš„è¯å¾ªç¯åˆ¤æ–­ å¦‚æœæ˜¯å¯¹è±¡å†æ¬¡è°ƒç”¨renderæ–¹æ³•
                    if(typeof item === 'object'){
                        render(item,elementNode)
                    }else{ //æ˜¯æ–‡æœ¬èŠ‚ç‚¹ ç›´æ¥åˆ›å»ºå³å¯
                        elementNode.appendChild(document.createTextNode(item));
                    }
                })
            }else{ // åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ç›´æ¥åˆ›å»ºå³å¯
                elementNode.appendChild(document.createTextNode(props[attr]));
            }
        }else if(attr === 'className'){ // æ˜¯ä¸æ˜¯classå±æ€§ class å±æ€§ç‰¹æ®Šå¤„ç†
            elementNode.setAttribute('class',props[attr]);
        }else{
            elementNode.setAttribute(attr,props[attr]);
        }
    }
    container.appendChild(elementNode)
};
//ReactDOM.render(<div>hello<span>world</span></div>);
//ReactDOM.render(React.createElement("div",null,"hello,",React.createElement("span",null,"world")));
render(React.createElement("div",null,"hello,",React.createElement("span",{class:"red"},"world")),document.getElementById('root'));

</script>
</body>
</html>

```

### 16.3 åº”ç”¨åœºæ™¯

#### 16.3.1 æ–‡ä»¶å¤¹å’Œæ–‡ä»¶

```
function Folder(name) {
    this.name=name;
    this.children=[];
    this.parent=null;
    this.level=0;
}
Folder.prototype.add=function (child) {
    child.level=this.level+1;
    child.parent=this;
    this.children.push(child);
}
Folder.prototype.show=function () {
    console.log(' '.repeat(this.level)+'æ–‡ä»¶å¤¹'+this.name);
    for (let i=0;i<this.children.length;i++){
        this.children[i].show();
    }
}
Folder.prototype.remove=function () {
    if (!this.parent) return;
    for (let i=0;i<this.parent.children.length;i++){
        let current=this.parent.children[i];
        if (current === this) {
            return this.parent.children.splice(i,1);
        }
    }
}

function File(name) {
    this.name=name;
}
File.prototype.add=function () {
    throw new Error(`æ–‡ä»¶ä¸‹é¢ä¸èƒ½å†æ·»åŠ æ–‡ä»¶`);
}
File.prototype.show=function () {
    console.log(' '.repeat(this.level)+'æ–‡ä»¶'+this.name);
}

let folder=new Folder('è§†é¢‘');
let vueFolder=new Folder('Vueè§†é¢‘');
let reactFolder=new Folder('Reactè§†é¢‘');
let vueFile=new File('Vueä»å…¥é—¨åˆ°ç²¾é€š');
let reactFile=new File('Reactä»å…¥é—¨åˆ°ç²¾é€š');
folder.add(vueFolder);
folder.add(reactFolder);
vueFolder.add(vueFile);
reactFolder.add(reactFile);

folder.show();
vueFolder.remove();
folder.show();

```

#### 16.3.2 ç»˜åˆ¶è¡¨å•

```
class FormContainer {
    constructor(type) {
        this.element = document.createElement(type);
        this.children = [];
    }
    add(child) {
        this.children.push(child);
        this.element.appendChild(child.element);
        return this;
    }
}
class FieldContainer {
    constructor(type) {
        this.element = document.createElement(type);
        this.children = [];
    }
    add(child) {
        this.children.push(child);
        this.element.appendChild(child.element);
        return this;
    }
}
class LabelItem {
    constructor(title) {
        this.element = document.createElement('label');
        this.element.innerHTML = title;
    }
}
class InputItem {
    constructor(title) {
        this.element = document.createElement('input');
        this.element.name = title;
    }
}
class TipItem {
    constructor(title) {
        this.element = document.createElement('span');
        this.element.innerHTML = title;
    }
}
let userform = new FormContainer('form').add(
    new FieldContainer('p').add(
        new LabelItem('ç”¨æˆ·å')
    ).add(
        new InputItem('username')
    ).add(
        new TipItem('ç”¨æˆ·åé•¿åº¦ä¸º6-8ä½')
    )
).add(new FieldContainer('p').add(
    new LabelItem('å¯†ç ')
).add(
    new InputItem('password')
).add(
    new TipItem('ç¡®è®¤å¯†ç ')
));
document.body.appendChild(userform.element);

```

## 17\. å‘½ä»¤æ¨¡å¼

-   æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå‘å¸ƒè€…å’Œæ‰§è¡Œè€…åˆ†å¼€
-   ä¸­é—´åŠ å…¥å‘½ä»¤å¯¹è±¡ï¼Œä½œä¸ºä¸­è½¬ç«™

ä¸‰ç§è§’è‰²

-   `Receiver`æ¥å—è€…è§’è‰²ï¼šè¯¥è§’è‰²å°±æ˜¯å¹²æ´»çš„è§’è‰²ï¼Œå‘½ä»¤ä¼ é€’åˆ°è¿™é‡Œæ˜¯åº”è¯¥è¢«æ‰§è¡Œçš„
-   `Command`å‘½ä»¤è§’è‰²ï¼šéœ€è¦æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤éƒ½åœ¨è¿™é‡Œå£°æ˜
-   `Invoker`è°ƒç”¨è€…è§’è‰²ï¼šæ¥æ”¶åˆ°å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤

### 17.1 ç±»å›¾

![command](https://images.gitee.com/uploads/images/2019/0109/192759_3f5aa289_1720749.jpeg)

### 17.2 ä»£ç 

```
class Cooker{
    cook() {
        console.log(`åšé¥­`);    
    }
}
class Cleaner{
    clean() {
        console.log(`æ¸…æ´`);    
    }
}


class CookCommand{
    constructor(cooker) {
        this.cooker=cooker;
    }
    execute() {
        this.cooker.cook();
    }
}
class CleanCommand{
    constructor(cleaner) {
        this.cleaner=cleaner;
    }
    execute() {
        this.cleaner.clean();
    }
}

class Customer{
    constructor(command) {
        this.command=command;
    }
    cook() {
        this.command.execute();
    }
    clean() {
        this.command.execute();
    }
}
let cooker=new Cooker();
let command=new CookCommand(cooker);
let c=new Customer(command);
c.cook();
let cleaner=new Cleaner();
c.command = new CleanCommand(cleaner);
c.clean();

```

### 17.3 åº”ç”¨åœºæ™¯

#### 17.3.1 è®¡æ•°å™¨

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>è®¡æ•°å™¨</title>
</head>
<body>
    <p id="number">0</p>
    <button id="addBtn">ç‚¹å‡»æŒ‰é’®</button>
<script>
 let addBtn = document.getElementById('addBtn');
 let number = document.getElementById('number');

 let worker = {
  add(){
   number.innerHTML = parseInt(number.innerHTML)+1;
  }
 }

 class AddCommand{
     constructor(receiver){
         this.receiver = receiver;
     }
     execute(){
         this.receiver.add();
     }
 }

let addCommand = new AddCommand(worker);
addBtn.onclick = ()=>addCommand.execute();
</script>    
</body>
</html>

```

#### 17.3.2 æ’¤é”€å’Œé‡åš

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å¼¹å‡ºèœå•</title>
</head>
<body>
    <p id="number">0</p>
    <button id="addBtn">+</button>
    <button id="undoBtn">undo</button>
<script>
 let addBtn = document.getElementById('addBtn');
 let undoBtn = document.getElementById('undoBtn');
 let number = document.getElementById('number');

 let worker = {
  lastVal:-1,
  add(){
   let oldVal = parseInt(number.innerHTML);     
   worker.lastVal = oldVal; 
   number.innerHTML = oldVal+1;
  },
  undo(){
      number.innerHTML = worker.lastVal;
  }
 }

 class AddCommand{
     constructor(receiver){
         this.receiver = receiver;
     }
     execute(){
         this.receiver.add();
     }
 }

 let addCommand = new AddCommand(worker);
 class UndoCommand{
     constructor(receiver){
         this.receiver = receiver;
     }
     execute(){
         this.receiver.undo();
     }
 }

 let undoCommand = new UndoCommand(worker);
 addBtn.onclick = ()=>addCommand.execute();
 undoBtn.onclick = ()=>undoCommand.execute();
</script>    
</body>
</html>

```

#### 17.3.3 å¤šæ­¥æ’¤é”€å’Œé‡åš

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å¼¹å‡ºèœå•</title>
</head>
<body>
    <p id="number">0</p>
    <button id="addBtn">+</button>
    <button id="undoBtn">undo</button>
    <button id="redoBtn">undo</button>
<script>
 let addBtn = document.getElementById('addBtn');
 let undoBtn = document.getElementById('undoBtn');
 let redoBtn = document.getElementById('redoBtn');
 let number = document.getElementById('number');

 let worker = {
  history:[],
  index:-1,
  add(){
   let oldVal = parseInt(number.innerHTML);     
   let newVal = oldVal + 1;
   worker.history.push(newVal);
   worker.index = worker.history.length-1;
   number.innerHTML = newVal;
   console.log(worker);
  },
  undo(){
      if(worker.index-1>=0){
          worker.index--;
        number.innerHTML = worker.history[worker.index];
        console.log(worker);
      }
  },
  redo(){
      if(worker.index+1<worker.history.length){
        worker.index++;  
        number.innerHTML = worker.history[worker.index];
        console.log(worker);
      }
  }
 }

 class AddCommand{
     constructor(receiver){
         this.receiver = receiver;
     }
     execute(){
         this.receiver.add();
     }
 }

 let addCommand = new AddCommand(worker);
 class UndoCommand{
     constructor(receiver){
         this.receiver = receiver;
     }
     execute(){
         this.receiver.undo();
     }
 }

 let undoCommand = new UndoCommand(worker);
 class RedoCommand{
     constructor(receiver){
         this.receiver = receiver;
     }
     execute(){
         this.receiver.redo();
     }
 }

let redoCommand = new RedoCommand(worker);
addBtn.onclick = ()=>addCommand.execute();
undoBtn.onclick = ()=>undoCommand.execute();
redoBtn.onclick = ()=>redoCommand.execute();
</script>    
</body>
</html>

```

## 18\. äº«å…ƒæ¨¡å¼

-   å…±äº«å†…å­˜ï¼ŒèŠ‚çº¦å†…å­˜ç©ºé—´
-   ç›¸åŒçš„æ•°æ®å…±äº«ä½¿ç”¨
-   ä¸»è¦è¿˜æ˜¯å¯¹æ•°æ®ã€æ–¹æ³•å…±äº«åˆ†ç¦»ï¼Œå°†æ•°æ®çš„æ–¹æ³•åˆ†ä¸ºå†…éƒ¨æ•°æ®ã€å†…éƒ¨æ–¹æ³•å’Œå¤–éƒ¨æ•°æ®ã€å¤–éƒ¨æ–¹æ³•ã€‚
-   å†…éƒ¨çŠ¶æ€ä¿å­˜åœ¨å¯¹è±¡å†…éƒ¨ï¼Œé€šå¸¸ä¸ä¼šæ”¹å˜ï¼Œå¯ä»¥å…±äº«
-   å¤–éƒ¨çŠ¶æ€ä¿å­˜åœ¨å¯¹è±¡å¤–éƒ¨ï¼Œå¯ä»¥éšåœºæ™¯æ”¹å˜ï¼Œä¸å¯ä»¥å…±äº«ã€‚

### 18.1 ç±»å›¾

![flyweight](https://images.gitee.com/uploads/images/2019/0109/192759_f42650d7_1720749.jpeg)

### 18.2 ä»£ç 

```
function Person(name,age) {
    this.name=name;
    this.age=age;
}
Person.prototype.getAge=function () {
    console.log(this.age)
}
Person.prototype.getName=function () {
    console.log(this.name)
}

```

### 18.3 åœºæ™¯

#### 18.3.1 å¯¹è±¡

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

<input type="radio" value="red" name="color" checked/>çº¢ 
<input type="radio" value="yellow" name="color"/>é»„ 
<input type="radio" value="blue" name="color"/>è“

<button onclick="draw()">ç»˜åˆ¶</button>

<div id="container">

</div>

<script>
let container = document.getElementById('container');
class MyDiv{
    constructor(){
      this.element = document.createElement('div');
    }
    setColor(color){
        this.element.style = `width:100px;height:100px;background-color:${color}`; 
    }
}
let div = new MyDiv();
function draw(){
  let color = Array.from(document.getElementsByName('color')).find(item=>item.checked).value||'red';
  div.setColor(color);
  container.appendChild(div.element);
}
</script>
</body>
</html>

```

#### 18.3.2 åˆ†é¡µ

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<ul id="news">

</ul>
<button id="nextPage" onclick="goNext()">ä¸‹ä¸€é¡µ</button>
<script>
let list = [];
for(let i=0;i<20;i++){
    list[i]=`æ–°é—»${i+1}`
}
let pageNum = 0;
let pageSize = 5;
let news = document.getElementById('news');
for(let i=0;i<list.length;i++){
    let li = document.createElement('li');
    li.innerHTML = `æ–°é—»${i+1}`;
    li.style.display = 'none';
    news.appendChild(li);
}
function goNext(){
  pageNum++;
  let start = (pageNum -1)*pageSize;
  let lis = document.getElementsByTagName('li');
  for(let i=0;i<=lis.length;i++){
     let li = lis[i];
     if(i>=start && i<start+pageSize){
         li.style.display = 'block';
     }else{
         li.style.display = 'none';
     }
  }
}
goNext();
</script>
</body>
</html>

```

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<ul id="news">

</ul>
<button id="nextPage" onclick="goNext()">ä¸‹ä¸€é¡µ</button>

<script>
let list = [];
for(let i=0;i<20;i++){
    list[i]=`æ–°é—»${i+1}`
}
let getLi = (function(){
    let lis = [];
    return function(){
        let element;
        if(lis.length<5){
            element = document.createElement('li');
            lis.push(element);
        }else{
            element = lis.shift();
            lis.push(element);
        }
            return element;
    }
})();

let pageNum = 0;
let pageSize = 5;
let news = document.getElementById('news');
function goNext(){
  pageNum++;
  let start = (pageNum -1)*pageSize;
  for(let i=1;i<=5;i++){
      let element = getLi();
      element.innerHTML = `æ–°é—»${start+i}`;
      news.appendChild(element);
  }
}
goNext();

</script>
</body>
</html>

```

## 19\. æ¨¡ç‰ˆæ–¹æ³•

-   æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ä¸­
-   æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­æŸäº›æ­¥éª¤çš„å…·ä½“å®ç°
-   ä¸€èˆ¬æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æŠ½è±¡çˆ¶ç±»ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å…·ä½“çš„å®ç°å­ç±»
-   å¥½è±ååŸåˆ™ï¼Œå­ç±»æ”¾å¼ƒäº†æ§åˆ¶æƒï¼Œæ”¹ç”±çˆ¶ç±»æ¥è°ƒç”¨
    -   å‘å¸ƒè®¢é˜…
    -   å›è°ƒå‡½æ•°

### 19.1 ç±»å›¾

![template](https://images.gitee.com/uploads/images/2019/0109/192759_375f96b8_1720749.jpeg)

### 19.2 ä»£ç 

```
class Person{
    dinner() {
        this.buy();
        this.cook();
        this.eat();
    }
    buy() {}
    cook() {}
    eat() {}
}
class Jiangwen extends Person{
    buy() {console.log('ä¹°é»„ç“œ');}
    cook() {console.log('æ‹é»„ç“œ');}
    eat() {console.log('åƒé»„ç“œ');}
}
let j=new Jiangwen();
j.dinner();

```

### 19.3 åœºæ™¯

#### 19.3.1 æç¤ºæ¡†

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="3.css">
</head>
<body>

<script src="3.js"></script>    
<script>
let dialog = new ConfirmDialog({
    title:'æ ‡é¢˜',
    content:'å†…å®¹'
});
</script>
</body>
</html>

```

```
class Dialog{
    constructor(options) {
        this.title = options.title||'æ ‡é¢˜';
        this.content = options.content||'å†…å®¹';
        this.onConfirm = options.onConfirm||this.hide;
        this.onCancel = options.onCancel||this.hide;
        this.init();
        this.initEventHandler();
    }
    init() {
        this.panel=document.createElement('div');
        this.panel.className='dialog';

        this.titleP=document.createElement('p');
        this.titleP.innerHTML=this.title;
        this.panel.appendChild(this.titleP);

        this.contentP=document.createElement('p');
        this.contentP.innerHTML=this.content;
        this.panel.appendChild(this.contentP);

        this.confirmBtn=document.createElement('button');
        this.confirmBtn.className='button confirm-button';
        this.confirmBtn.innerHTML='ç¡®å®š';
        this.panel.appendChild(this.confirmBtn);

        this.cancelBtn=document.createElement('button');
        this.cancelBtn.className='button cancel-button';
        this.cancelBtn.innerHTML='å–æ¶ˆ';
        this.panel.appendChild(this.cancelBtn);

        document.body.appendChild(this.panel);
    }
    inithttp://image.bubuko.com/info/201807/20180712173511381297.pngntListener('click',() => {
            this.onConfirm();
            this.hide();
        });
        this.cancelBtn.addEventListener('click',() => {
            this.onCancel();
            this.hide();
        });
    }
    show() {
        this.panel.style.display='block';
    }
    hide() {
        this.panel.style.display='none';
    }
}

class ContentDialog extends Dialog{
    init() {
        super.init();
        this.titleP.parentNode.removeChild(this.titleP);
    }
}

class ConfirmDialog extends Dialog{
    init() {
        super.init();
        this.cancelBtn.parentNode.removeChild(this.cancelBtn);
    }
}

```

```
.dialog{
    width:400px;
    height:300px;
    position: absolute;
    padding:20px;
    top:50%;
    left:50%;
    margin-left:-200px;
    margin-top:-150px;
    border:1px solid#000;
    background-color: #EEE;
    border-radius: 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.dialog button{
    width:100px;
    height:30px;
    position: absolute;
    border: none;
    outline: none;

}
.dialog .confirm-button {
    right:140px;
    bottom:20px;
}
.dialog .cancel-button {
    right:20px;
    bottom:20px;
}

```

#### 19.3.2

![react-lifecycle](https://images.gitee.com/uploads/images/2019/0109/192800_bdf6372b_1720749.png)

## 20\. èŒè´£é“¾æ¨¡å¼

-   ä¸€æ­¥æ“ä½œå¯èƒ½åˆ†ä¸ºå¤šä¸ªèŒè´£è§’è‰²æ¥å®Œæˆ
-   æŠŠè¿™äº›è§’è‰²éƒ½åˆ†å¼€ï¼Œç„¶åç”¨ä¸€ä¸ªé“¾ä¸²èµ·æ¥
-   å°†å‘èµ·è€…å’Œå„ä¸ªå¤„ç†è€…è¿›è¡Œéš”ç¦»

### 20.1 ç±»å›¾

![responsibility](https://images.gitee.com/uploads/images/2019/0109/192759_0dc3a8f6_1720749.jpeg)

### 20.2 ä»£ç 

```
class Employee{
    constructor(next) {
        this.next=next;
    }
}
class GroupLeader extends Employee{
    audit() {
        console.log(`ç»„é•¿å·²ç»å®¡æ‰¹!`);
        this.next&&this.next.audit();
    }
}
class Manager extends Employee{
    audit() {
        console.log(`ç»ç†å·²ç»å®¡æ‰¹!`);
        this.next&&this.next.audit();
    }
}
class Boss extends Employee{
    audit() {
        console.log(`è€æ¿å·²ç»å®¡æ‰¹!`);
        this.next&&this.next.audit();
    }
}
let boss=new Boss();
let manager=new Manager(boss);
let groupLeader=new GroupLeader(manager);
groupLeader.audit();


```

## 21\. å¤‡å¿˜å½•æ¨¡å¼

-   è®°å½•ä¸€ä¸ªå¯¹è±¡çš„å˜åŒ–
-   å¯ä»¥æ¢å¤ä¹‹å‰çš„æŸä¸ªçŠ¶æ€

### 21.1 ç±»å›¾

![memos](https://images.gitee.com/uploads/images/2019/0109/192759_153a110d_1720749.jpeg)

### 21.2 ä»£ç 

```
    <input type="text" id="content">
    <button id="save-btn">ä¿å­˜</button>
    <button id="prev-btn">ä¸Šä¸€æ­¥</button>
    <button id="next-btn">ä¸‹ä¸€æ­¥</button>
    <script>
      let content = document.getElementById('content');
      let saveBtn = document.getElementById('save-btn');
      let prevBtn = document.getElementById('prev-btn');
      let nextBtn = document.getElementById('next-btn');
      class Memo{
          constructor(content){
              this.content = content;
          }
      }
      class Memos {
          constructor(){
              this.index = 0;
              this.list = [new Memo('')];
          }
          add(content){
              this.list[++this.index] = new Memo(content);
          }
          get(){
              return this.list[this.index];
          }
          prev(){
              if(this.index ==0) return alert('æ²¡æœ‰ä¸Šä¸€æ­¥');
              return this.list[--this.index];
          }
          next(){
               if(this.index ==this.list.length-1) return alert('æ²¡æœ‰ä¸‹ä¸€æ­¥');
              return this.list[++this.index];
          }
      }
      let memos = new Memos();
      saveBtn.addEventListener('click',function(){
          memos.add(content.value);
      });
      prevBtn.addEventListener('click',function(){
          let memo = memos.prev();
          content.value = memo.content;
      });
      nextBtn.addEventListener('click',function(){
          let memo = memos.next();
          content.value = memo.content;
      });
    </script>

```

## 22\. ä¸­ä»‹è€…æ¨¡å¼

### 22.1 ç±»åº“

![mediator](https://images.gitee.com/uploads/images/2019/0109/192759_bb120e34_1720749.jpeg)

### 22.2 ä»£ç 

```
class Boy{
    constructor(mediator) {
        this.mediator=mediator;
        this.salary=1000;
    }
    learnGirl() {
        this.mediator.learnGirl();
    }
}
class Girl{
    constructor(mediator) {
        this.mediator=mediator;
        this.age=28;
    }
    learnBoy() {
        this.mediator.learnBoy();
    }
}
class Mediator{
    constructor(boy,girl) {
        this.boy=boy;
        this.girl=girl;
    }
    learnBoy() {
        console.log(`è¿™ä¸ªç”·å­©æœˆè–ª${this.boy.salary*10}`);
    }
    learnGirl() {
        console.log(`è¿™ä¸ªå¥³å­©å¹´é¾„${this.girl.age-10}`);
    }
}
let boy=new Boy();
let girl=new Girl();
let mediator=new Mediator(boy,girl);
boy.mediator=mediator;
girl.mediator=mediator;
boy.learnGirl();
girl.learnBoy();

```

## 23\. è®¿é—®è€…æ¨¡å¼

-   å°†æ•°æ®æ“ä½œå’Œæ•°æ®ç»“æ„è¿›è¡Œåˆ†ç¦»
-   æœ‰è¿™ä¹ˆä¸€ä¸ªæ“ä½œï¼Œå®ƒæ˜¯ä½œç”¨äºä¸€äº›å…ƒç´ ä¹‹ä¸Šçš„ï¼Œè€Œè¿™äº›å…ƒç´ å±äºæŸä¸€ä¸ªå¯¹è±¡ç»“æ„ã€‚
-   åŒæ—¶è¿™ä¸ªæ“ä½œæ˜¯åœ¨ä¸æ”¹å˜å„å…ƒç´ ç±»çš„å‰æä¸‹ï¼Œåœ¨è¿™ä¸ªå‰æä¸‹å®šä¹‰æ–°æ“ä½œæ˜¯è®¿é—®è€…æ¨¡å¼ç²¾é«“ä¸­çš„ç²¾é«“ã€‚

### 23.1 ç»„æˆéƒ¨åˆ†

-   ObjectStructureï¼šå®šä¹‰å½“ä¸­æ‰€è¯´çš„å¯¹è±¡ç»“æ„ï¼Œå¯¹è±¡ç»“æ„æ˜¯ä¸€ä¸ªæŠ½è±¡è¡¨è¿°ï¼Œå®ƒå†…éƒ¨ç®¡ç†äº†å…ƒç´ é›†åˆï¼Œå¹¶ä¸”å¯ä»¥è¿­ä»£è¿™äº›å…ƒç´ ä¾›è®¿é—®è€…è®¿é—®ã€‚
-   Elementï¼šå…ƒç´ æ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ¥å—è®¿é—®è€…çš„æ–¹æ³•ï¼ˆAcceptï¼‰ï¼Œå…¶æ„ä¹‰æ˜¯æŒ‡æ¯ä¸€ä¸ªå…ƒç´ éƒ½è¦å¯ä»¥è¢«è®¿é—®è€…è®¿é—®ã€‚
-   ConcreteElementAã€ConcreteElementBï¼šå…·ä½“çš„å…ƒç´ ç±»ï¼Œå®ƒæä¾›æ¥å—è®¿é—®æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè€Œè¿™ä¸ªå…·ä½“çš„å®ç°ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä½¿ç”¨è®¿é—®è€…æä¾›çš„è®¿é—®è¯¥å…ƒç´ ç±»çš„æ–¹æ³•ã€‚
-   Visitorï¼šæ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†å¯¹æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆElementï¼‰è®¿é—®çš„è¡Œä¸ºï¼Œå®ƒçš„å‚æ•°å°±æ˜¯å¯ä»¥è®¿é—®çš„å…ƒç´ ï¼Œå®ƒçš„æ–¹æ³•æ•°ç†è®ºä¸Šæ¥è®²ä¸å…ƒç´ ä¸ªæ•°æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ï¼Œè®¿é—®è€…æ¨¡å¼è¦æ±‚å…ƒç´ çš„ç±»æ—è¦ç¨³å®šï¼Œå¦‚æœç»å¸¸æ·»åŠ ã€ç§»é™¤å…ƒç´ ç±»ï¼Œå¿…ç„¶ä¼šå¯¼è‡´é¢‘ç¹åœ°ä¿®æ”¹Visitoræ¥å£ï¼Œå¦‚æœè¿™æ ·åˆ™ä¸é€‚åˆä½¿ç”¨è®¿é—®è€…æ¨¡å¼ã€‚

### 23.2 ç±»å›¾

![visitor](https://images.gitee.com/uploads/images/2019/0109/192759_6d3a62a9_1720749.jpeg)

### 23.3 ä»£ç 

```
class Father{
    constructor(name,wealth) {
        this.name=name;
        this.wealth=wealth;
    }
    accept(viewer) {
        viewer.viewFather(this);
    }
}
class Mother{
    constructor(name,character) {
        this.name=name;
        this.character=character;
    }
    accept(viewer) {
        viewer.viewMother(this);
    }
}
class Son{
    constructor(name,look) {
        this.name=name;
        this.look=look;
    }
    accept(viewer) {
        viewer.viewSon(this);
    }
}
class Family{
    constructor(father,mother,son) {
        this.father=father;
        this.mother=mother
        this.son=son;
    }
    view(viewer) {
        this.father.accept(viewer);
        this.mother.accept(viewer);
        this.son.accept(viewer);
    }
}

class Girl{
    constructor(name) {
        this.name=name;
    }
    viewFather(father) {
        console.log(`${this.name} ${father.name} çš„è´¢å¯Œ ${father.wealth}`);        
    }
    viewMother(mother) {
        console.log(`${this.name} ${mother.name} çš„æ€§æ ¼ ${mother.character}`);        
    }
    viewSon(son) {
        console.log(`${this.name} ${son.name} çš„ç›¸è²Œ ${son.look}`);        
    }
}
let father=new Father('å†¯çˆ¸çˆ¸',999999);
let mother=new Mother('å†¯å¦ˆå¦ˆ','æ¸©æŸ”');
let son=new Son('å†¯ç»å³°','å¸…');
let family=new Family(father,mother,son);
let zhaoliying=new Girl('èµµä¸½é¢–');
family.view(zhaoliying);

```

### 23.3 åº”ç”¨åœºæ™¯

```
let babel = require('babel-core');
let t=require('babel-types');
let preCalculator={
    visitor: {
        BinaryExpression(path) {
            let node=path.node;
            console.log(node.operator);
        }
    }
}


const result = babel.transform('const sum = 1+2',{
    plugins:[
        preCalculator
    ]
});
//console.log(result.code);

```

## 24\. è§£é‡Šå™¨æ¨¡å¼

-   æè¿°è¯­è¨€è¯­æ³•å¦‚ä½•å®šä¹‰ï¼Œå¦‚ä½•è§£é‡Šå’Œç¼–è¯‘
-   [è§£é‡Šå™¨æ¨¡å¼](https://www.cnblogs.com/chenssy/p/3346427.html)
    
    ### 24.1 ç±»å›¾
    

### 24.2 ä»£ç 

Powered by [idoc](https://github.com/jaywcjlove/idoc). Dependence [Node.js](https://nodejs.org) run.